<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Rimuru&#39;s Blog</title>
  
  <subtitle>又是CUDA Out of Memory的一天</subtitle>
  <link href="https://blog.rimuru.cc/atom.xml" rel="self"/>
  
  <link href="https://blog.rimuru.cc/"/>
  <updated>2026-01-11T23:58:34.000Z</updated>
  <id>https://blog.rimuru.cc/</id>
  
  <author>
    <name>Rimuru</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>基于Cloudflare的内网穿透解决方案（含安全认证及动态IP白名单）</title>
    <link href="https://blog.rimuru.cc/2026/01/11/%E5%9F%BA%E4%BA%8ECloudflare%E7%9A%84%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%88%E5%90%AB%E5%AE%89%E5%85%A8%E8%AE%A4%E8%AF%81%E5%8F%8A%E5%8A%A8%E6%80%81IP%E7%99%BD%E5%90%8D%E5%8D%95%EF%BC%89/"/>
    <id>https://blog.rimuru.cc/2026/01/11/%E5%9F%BA%E4%BA%8ECloudflare%E7%9A%84%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%88%E5%90%AB%E5%AE%89%E5%85%A8%E8%AE%A4%E8%AF%81%E5%8F%8A%E5%8A%A8%E6%80%81IP%E7%99%BD%E5%90%8D%E5%8D%95%EF%BC%89/</id>
    <published>2026-01-11T21:29:43.000Z</published>
    <updated>2026-01-11T23:58:34.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>目前，内网穿透的解决方案有很多，比如frp、ngrok等，但这些方案在安全性和易用性方面仍有提升空间。本文将介绍一种基于Cloudflare的内网穿透解决方案，结合安全认证和动态IP白名单机制，提升内网穿透服务的安全性和可靠性。</p><h2 id="方案概述"><a href="#方案概述" class="headerlink" title="方案概述"></a>方案概述</h2><p>本方案利用Cloudflare的Zero Trust（原Cloudflare Access）和Cloudflare Tunnel（原Argo Tunnel）功能，实现内网服务的安全访问。通过配置安全认证和基于Cloudfare Worker的动态IP白名单，确保只有授权用户能够访问内网资源，同时适配不支持认证的客户端。</p><h2 id="前期准备"><a href="#前期准备" class="headerlink" title="前期准备"></a>前期准备</h2><ol><li>Cloudflare账号及域名</li><li>Docker环境（可选）</li><li>npm环境（用于部署Worker脚本）</li></ol><h2 id="详细步骤"><a href="#详细步骤" class="headerlink" title="详细步骤"></a>详细步骤</h2><h3 id="1-配置Cloudflare-Tunnel"><a href="#1-配置Cloudflare-Tunnel" class="headerlink" title="1. 配置Cloudflare Tunnel"></a>1. 配置Cloudflare Tunnel</h3><ul><li><p>登录Cloudflare控制台，选择“Zero Trust”。</p></li><li><p>导航到“网络” &gt; “连接器”</p></li><li><p>选择“创建隧道” &gt; “选择Cloudflared” &gt; 填入名称 &gt; “保存隧道”。</p></li><li><p>启动隧道。网页会提供一段命令，复制并在内网服务器上执行以启动Cloudflared隧道。默认显示Windows，可以切换”Mac”,”Debian,”Red Hat”,”Docker”等系统。</p></li><li><p>特别提供docker compose方式启动隧道：</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">cloudflared:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">cloudflare/cloudflared:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">cloudflared</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">tunnel</span> <span class="string">--no-autoupdate</span> <span class="string">run</span> <span class="string">--token</span> <span class="string">&lt;YOUR_TUNNEL_TOKEN&gt;</span></span><br></pre></td></tr></table></figure><ul><li>选择“路由隧道”&#x2F;“已发布应用程序路由”添加路由，填写子域名和内网服务地址（如<code>http://localhost:8080</code>）。注意不要经过nginx等代理，直接填写内网服务地址。</li></ul><h3 id="2-配置Cloudflare-Access安全认证"><a href="#2-配置Cloudflare-Access安全认证" class="headerlink" title="2. 配置Cloudflare Access安全认证"></a>2. 配置Cloudflare Access安全认证</h3><ul><li><p>在Cloudflare控制台，导航到“Zero Trust” &gt; “访问控制” &gt; “应用程序” &gt; “添加应用程序”。输入应用名称，添加公共主机名（即上一步配置的子域名）。</p></li><li><p>选择“创建新新策略”输入策略名称，操作选择“允许”，选择器类型选择“电子邮件”，输入允许访问的用户邮箱（可根据需要选择其他认证方式，不支持认证的客户端应用等后面介绍处理办法）。保存策略。</p></li><li><p>回到应用程序页面，选择现有策略，关联刚创建的策略。</p></li><li><p>现在，访问该子域名时会被重定向到Cloudflare的认证页面，只有通过认证的用户才能访问内网服务。</p></li></ul><h3 id="3-配置动态IP白名单（可选）"><a href="#3-配置动态IP白名单（可选）" class="headerlink" title="3. 配置动态IP白名单（可选）"></a>3. 配置动态IP白名单（可选）</h3><h4 id="3-1-适用场景"><a href="#3-1-适用场景" class="headerlink" title="3.1 适用场景"></a>3.1 适用场景</h4><ul><li>如果应用程序不支持Cloudflare Access认证，或者频繁的认证不便，可以通过Cloudflare Worker实现动态IP白名单功能。</li></ul><h4 id="3-2-部署项目"><a href="#3-2-部署项目" class="headerlink" title="3.2 部署项目"></a>3.2 部署项目</h4><ul><li><p>使用项目<a href="https://github.com/AinzRimuru/cloudflare_dynamic_ip_list">cloudflare_dynamic_ip_list</a>来实现动态IP白名单功能。</p></li><li><p>克隆项目到本地</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/AinzRimuru/cloudflare_dynamic_ip_list.git</span><br></pre></td></tr></table></figure><ul><li>创建KV Namespace用于维护IP的过期状态，运行以下命令创建KV命名空间，并记下返回的ID，填入<code>wrangler.toml</code>中的<code>[[kv_namespaces]]</code>部分的<code>id</code>字段：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wrangler kv namespace create IP_WHITELIST</span><br></pre></td></tr></table></figure><ul><li><p>创建List用于存储允许访问的IP地址: 打开<code>ZeroTrust</code> &gt; <code>可重用组件</code> &gt; <code>列表</code> &gt; <code>创建列表</code>，名称无要求，创建后记下列表ID（点开List页面，在URL中可以看到ID，形如<code>********-****-****-****-************</code>）。将该ID填入<code>wrangler.toml</code>中的<code>[vars]</code>部分的<code>LIST_ID</code>字段。</p></li><li><p>获取ACCOUNT_ID: 打开<code>计算和AI</code> &gt; <code>Workers和Pages</code>，在右边可以看到<code>Account Details</code>，记下<code>Account ID</code>，填入<code>wrangler.toml</code>中的<code>ACCOUNT_ID</code>字段。</p></li><li><p>配置允许的域名（可选）：如果配置了新域名，且希望仅允许该域名访问，可以在<code>wrangler.toml</code>中的<code>[vars]</code>部分的<code>ALLOWED_HOSTS</code>字段添加域名，多个域名用逗号分隔。如果不配置该字段，则允许所有域名访问。</p></li><li><p>部署Worker脚本：</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npx wrangler login</span><br><span class="line">npx wrangler deploy --config config/wrangler.toml</span><br></pre></td></tr></table></figure><h4 id="3-3-配置白名单的Bypass策略"><a href="#3-3-配置白名单的Bypass策略" class="headerlink" title="3.3 配置白名单的Bypass策略"></a>3.3 配置白名单的Bypass策略</h4><ul><li><p>配置白名单Bypass路由：在Cloudflare控制台，导航到<code>Zero Trust</code> &gt; <code>访问控制</code> &gt; <code>策略</code>，创建新策略，名称自定义，操作选择<code>BYPASS</code>，选择器类型选择<code>IP List</code>, 值为刚创建的List名称。保存策略。</p></li><li><p>现在，将策略添加到刚刚创建的应用程序中，排名第1位。这样，IP在白名单中的请求将绕过认证直接访问内网服务。</p></li></ul><h4 id="3-4-IP白名单的注册鉴权（Token方式）"><a href="#3-4-IP白名单的注册鉴权（Token方式）" class="headerlink" title="3.4 IP白名单的注册鉴权（Token方式）"></a>3.4 IP白名单的注册鉴权（Token方式）</h4><ul><li><p>选择<code>Zero Trust</code> &gt; <code>访问控制</code> &gt; <code>服务凭据</code> &gt; <code>创建凭据</code>，输入名称，创建后记下<code>Client ID</code>和<code>Client Secret</code>。</p></li><li><p>新建应用程序，名称自定义，公共主机名填写Worker脚本的域名（如<code>your-worker.your-domain.com</code>）。</p></li><li><p>创建新策略，名称自定义，操作选择<code>SERVICE AUTH</code>，选择器类型选择<code>Service Token</code>，值为刚创建的服务凭据名称。保存策略。</p></li><li><p>回到Worker的应用程序页面，选择现有策略，关联刚创建的策略。</p></li></ul><h4 id="3-5-IP白名单的注册鉴权（Email方式）"><a href="#3-5-IP白名单的注册鉴权（Email方式）" class="headerlink" title="3.5 IP白名单的注册鉴权（Email方式）"></a>3.5 IP白名单的注册鉴权（Email方式）</h4><ul><li><p>创建新策略，名称自定义，操作选择<code>Allow</code>，选择器类型选择<code>Emails</code>，值为允许注册的邮箱地址，可以添加多个邮箱。</p></li><li><p>保存策略后，回到Worker的应用程序页面，选择现有策略，关联刚创建的策略。</p></li></ul><h4 id="3-6-使用说明"><a href="#3-6-使用说明" class="headerlink" title="3.6 使用说明"></a>3.6 使用说明</h4><ul><li><p>浏览器访问Worker脚本的域名，完成认证后，IP将被添加到白名单中，且在指定时间内有效。</p></li><li><p>对于不支持认证的客户端应用，可以选择使用自动化任务如（ios的快捷指令等）配置<code>CF-Access-Client-Id</code>和<code>CF-Access-Client-Secret</code>请求头，实现自动认证。</p></li></ul>]]></content>
    
    
    <summary type="html">本文详细介绍了基于Cloudflare Zero Trust和Tunnel实现的内网穿透方案。通过配置Cloudflared隧道、Access安全认证以及利用Cloudflare Worker构建动态IP白名单，有效解决了传统穿透工具在安全性与易用性上的痛点，为内网资源提供企业级的防火墙保护与灵活的访问控制。</summary>
    
    
    
    
    <category term="Cloudflare" scheme="https://blog.rimuru.cc/tags/cloudflare/"/>
    
    <category term="内网穿透" scheme="https://blog.rimuru.cc/tags/intranet-penetration/"/>
    
    <category term="网络安全" scheme="https://blog.rimuru.cc/tags/cybersecurity/"/>
    
  </entry>
  
  <entry>
    <title>Cloudflare代理网页导致页面跳转出现503的解决办法</title>
    <link href="https://blog.rimuru.cc/2026/01/05/Cloudflare%E4%BB%A3%E7%90%86%E7%BD%91%E9%A1%B5%E5%AF%BC%E8%87%B4%E9%A1%B5%E9%9D%A2%E8%B7%B3%E8%BD%AC%E5%87%BA%E7%8E%B0503%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/"/>
    <id>https://blog.rimuru.cc/2026/01/05/Cloudflare%E4%BB%A3%E7%90%86%E7%BD%91%E9%A1%B5%E5%AF%BC%E8%87%B4%E9%A1%B5%E9%9D%A2%E8%B7%B3%E8%BD%AC%E5%87%BA%E7%8E%B0503%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/</id>
    <published>2026-01-05T22:35:22.000Z</published>
    <updated>2026-01-05T23:08:35.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><p>不用处理</p><h2 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h2><p>Cloudflare代理网页时，如果页面跳转出现503并且对应的是prefetch的请求，那么该错误极大可能是因为Cloudflare的Speed Brain智能加速功能导致的。该加速功能会默认启用，通过在html中添加各种header来提示浏览器预加载页面，但这些加载请求不会被转发到源服务器，如果Cloudflare没有缓存相关的页面或资源，那么就会返回503错误，并伴随着一个响应头<code>cf-speculation-refused: prefetch refused: not eligible</code>。而当你回到跳转前的页面再次尝试跳转时，这个503的请求就不见了，因为Cloudflare已经缓存了这个页面，能够正常命中缓存。</p><h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h2><p>虽然这个报错不会影响到用户，但是如果执意要处理，那么可以禁用Cloudflare的Speed Brain智能加速功能。<br>入口在域名管理页面的”速度”&gt;”设置”&gt;”内容优化”</p>]]></content>
    
    
    <summary type="html">解决Cloudflare代理网页时出现503错误及cf-speculation-refused响应头的问题。本文深入分析了Cloudflare Speed Brain智能加速功能导致的prefetch请求失败原因，并提供了关闭该功能以消除503报错的详细步骤，适合使用Cloudflare进行CDN加速和网站优化的开发者参考。</summary>
    
    
    
    
    <category term="博客优化" scheme="https://blog.rimuru.cc/tags/blog-optimization/"/>
    
    <category term="Cloudflare" scheme="https://blog.rimuru.cc/tags/cloudflare/"/>
    
    <category term="CDN加速" scheme="https://blog.rimuru.cc/tags/cdn/"/>
    
    <category term="问题解决" scheme="https://blog.rimuru.cc/tags/problem-solving/"/>
    
    <category term="网络优化" scheme="https://blog.rimuru.cc/tags/network-optimization/"/>
    
    <category term="Speed Brain" scheme="https://blog.rimuru.cc/tags/speed-brain/"/>
    
    <category term="503错误" scheme="https://blog.rimuru.cc/tags/503-error/"/>
    
    <category term="网页预加载" scheme="https://blog.rimuru.cc/tags/page-preloader/"/>
    
  </entry>
  
  <entry>
    <title>Windows配置Claude Code代理（无额外依赖）</title>
    <link href="https://blog.rimuru.cc/2026/01/04/Windows%E9%85%8D%E7%BD%AEClaude-Code%E4%BB%A3%E7%90%86%EF%BC%88%E6%97%A0%E9%A2%9D%E5%A4%96%E4%BE%9D%E8%B5%96%EF%BC%89/"/>
    <id>https://blog.rimuru.cc/2026/01/04/Windows%E9%85%8D%E7%BD%AEClaude-Code%E4%BB%A3%E7%90%86%EF%BC%88%E6%97%A0%E9%A2%9D%E5%A4%96%E4%BE%9D%E8%B5%96%EF%BC%89/</id>
    <published>2026-01-04T18:21:59.000Z</published>
    <updated>2026-01-04T23:31:35.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="安装Claude-Code-已安装的自行跳过"><a href="#安装Claude-Code-已安装的自行跳过" class="headerlink" title="安装Claude Code (已安装的自行跳过)"></a>安装Claude Code (已安装的自行跳过)</h2><ol><li><a href="https://claude.com/product/claude-code">官网</a>的PowerShell一键安装<code>irm https://claude.ai/install.ps1 | iex</code>(我没成功，安装目录是空的)</li><li>npm安装<code>npm install -g @anthropic-ai/claude-code</code></li></ol><h2 id="配置代理"><a href="#配置代理" class="headerlink" title="配置代理"></a>配置代理</h2><ol><li>打开新PowerShell</li><li>查看<code>claude</code>安装位置<code>whereis claude</code></li><li>输出的路径可能是<code>/cygdrive/c/...</code>，去掉<code>/cygdrive/c</code>,使用<code>%HOMEDRIVE%/</code>拼接后面的内容</li><li>在资源管理器的路径中输入修改后的内容回车，选择用记事本&#x2F;VSCode打开输出目录中的<code>claude</code>文件</li><li>在<code>#!/bin/sh</code>下面追加<br><code>export HTTP_PROXY=&quot;http://&lt;ip&gt;:&lt;port&gt;&quot;;export HTTPS_PROXY=&quot;http://&lt;ip&gt;:&lt;port&gt;&quot;</code><br>修改后的文件如下所示：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="built_in">export</span> HTTP_PROXY=<span class="string">&quot;http://&lt;ip&gt;:&lt;port&gt;&quot;</span>; <span class="comment"># 这两行是新增的(替换为你的代理ip和端口)</span></span><br><span class="line"><span class="built_in">export</span> HTTPS_PROXY=<span class="string">&quot;http://&lt;ip&gt;:&lt;port&gt;&quot;</span>; <span class="comment"># 这两行是新增的(替换为你的代理ip和端口)</span></span><br><span class="line">basedir=$(<span class="built_in">dirname</span> <span class="string">&quot;<span class="subst">$(echo <span class="string">&quot;<span class="variable">$0</span>&quot;</span> | sed -e &#x27;s,\\,/,g&#x27;)</span>&quot;</span>)</span><br><span class="line">...</span><br></pre></td></tr></table></figure><ol start="6"><li>保存文件</li><li>开启代理工具（v2rayN）的TUN模式（上面的工作不做，只开启这个也不好使）</li><li>重新打开PowerShell，输入<code>claude</code>测试，如果一切顺利，可以开始登录。</li></ol>]]></content>
    
    
    <summary type="html">本文详细介绍了在 Windows 环境下为 Claude Code 配置网络代理的实操教程。通过修改 Claude 安装目录下的启动脚本并结合 TUN 模式，解决因网络环境导致的连接失败问题。无需额外依赖，步骤简单明了，涵盖 npm 安装、环境变量配置及代理生效测试，是开发者优化 Claude Code 使用体验的必备指南。</summary>
    
    
    
    
    <category term="教程" scheme="https://blog.rimuru.cc/tags/tutorial/"/>
    
    <category term="问题解决" scheme="https://blog.rimuru.cc/tags/problem-solving/"/>
    
    <category term="网络优化" scheme="https://blog.rimuru.cc/tags/network-optimization/"/>
    
    <category term="Windows 11" scheme="https://blog.rimuru.cc/tags/windows-11/"/>
    
    <category term="AI工具" scheme="https://blog.rimuru.cc/tags/ai-tools/"/>
    
    <category term="Claude Code" scheme="https://blog.rimuru.cc/tags/claude-code/"/>
    
    <category term="环境变量" scheme="https://blog.rimuru.cc/tags/environment-vars/"/>
    
    <category term="代理配置" scheme="https://blog.rimuru.cc/tags/proxy-configuration/"/>
    
  </entry>
  
  <entry>
    <title>解决高延迟场景中OpenVPN速度缓慢的问题</title>
    <link href="https://blog.rimuru.cc/2026/01/03/%E8%A7%A3%E5%86%B3%E9%AB%98%E5%BB%B6%E8%BF%9F%E5%9C%BA%E6%99%AF%E4%B8%ADOpenVPN%E9%80%9F%E5%BA%A6%E7%BC%93%E6%85%A2%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <id>https://blog.rimuru.cc/2026/01/03/%E8%A7%A3%E5%86%B3%E9%AB%98%E5%BB%B6%E8%BF%9F%E5%9C%BA%E6%99%AF%E4%B8%ADOpenVPN%E9%80%9F%E5%BA%A6%E7%BC%93%E6%85%A2%E7%9A%84%E9%97%AE%E9%A2%98/</id>
    <published>2026-01-03T22:08:11.000Z</published>
    <updated>2026-01-03T23:08:39.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="连接协议选择"><a href="#连接协议选择" class="headerlink" title="连接协议选择"></a>连接协议选择</h2><p>强制使用 UDP，1% 丢包在 TCP 下会被放大为严重的延迟，而 UDP 下则基本无影响。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proto udp</span><br></pre></td></tr></table></figure><h2 id="增加缓冲区"><a href="#增加缓冲区" class="headerlink" title="增加缓冲区"></a>增加缓冲区</h2><p>根据实际延迟与最大带宽计算出合理的缓冲区大小，单位为字节。<br>如延迟为100ms，最大带宽为100Mbps，那么缓冲区大小应该为100ms * 100Mbps * 1000 &#x2F; 8 &#x3D; 1250000Bytes。对应的配置为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sndbuf 1250000</span><br><span class="line">rcvbuf 1250000</span><br><span class="line">push &quot;sndbuf 1250000&quot;</span><br><span class="line">push &quot;rcvbuf 1250000&quot;</span><br></pre></td></tr></table></figure><p>上述值还可以适当调大。</p><h2 id="增加服务器的TCP-UDP缓冲区大小"><a href="#增加服务器的TCP-UDP缓冲区大小" class="headerlink" title="增加服务器的TCP&#x2F;UDP缓冲区大小"></a>增加服务器的TCP&#x2F;UDP缓冲区大小</h2><p>在<code>/etc/sysctl.conf</code>中添加以下内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 增大内核 UDP 缓冲区限制，适配高带宽深管道（BDP）</span><br><span class="line">net.core.rmem_max=16777216</span><br><span class="line">net.core.wmem_max=16777216</span><br><span class="line">net.core.rmem_default=16777216</span><br><span class="line">net.core.wmem_default=16777216</span><br><span class="line"></span><br><span class="line"># 启用 BBR 拥塞控制算法（对高延迟环境至关重要）</span><br><span class="line">net.core.default_qdisc=fq</span><br><span class="line">net.ipv4.tcp_congestion_control=bbr</span><br></pre></td></tr></table></figure><h2 id="提高nginx的缓冲区大小"><a href="#提高nginx的缓冲区大小" class="headerlink" title="提高nginx的缓冲区大小"></a>提高nginx的缓冲区大小</h2><p>修改nginx的配置文件，添加&#x2F;修改如下内容</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen 443 quic reuseport; # 启用 QUIC</span><br><span class="line">        http3 on; # 启用 HTTP/3</span><br><span class="line"></span><br><span class="line">        # 核心：增大单条 H3 流的缓冲区</span><br><span class="line">        # 设为 12m 可以支撑 200ms 延迟下约 500Mbps 的理论吞吐量</span><br><span class="line">        http3_stream_buffer_size 12m; # 增大单条 H3 流的缓冲区</span><br><span class="line"></span><br><span class="line">        # 增大代理缓冲区</span><br><span class="line">        proxy_buffers 16 1024k;</span><br><span class="line">        proxy_busy_buffers_size 15360k;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">针对高延迟场景下的OpenVPN速度缓慢问题，本文提供了全方位的性能调优方案。涵盖了强制UDP协议、计算并优化sndbuf/rcvbuf缓冲区、调整Linux内核sysctl参数以及启用BBR拥塞控制算法。此外还介绍了如何通过Nginx配置HTTP/3和QUIC缓冲区，以显著提升高延迟网络环境下的吞吐量和稳定性。</summary>
    
    
    
    
    <category term="教程" scheme="https://blog.rimuru.cc/tags/tutorial/"/>
    
    <category term="反向代理" scheme="https://blog.rimuru.cc/tags/options/"/>
    
    <category term="问题解决" scheme="https://blog.rimuru.cc/tags/problem-solving/"/>
    
    <category term="网络优化" scheme="https://blog.rimuru.cc/tags/network-optimization/"/>
    
    <category term="Linux" scheme="https://blog.rimuru.cc/tags/linux/"/>
    
    <category term="运维命令" scheme="https://blog.rimuru.cc/tags/om-orders/"/>
    
    <category term="系统监控" scheme="https://blog.rimuru.cc/tags/system-monitoring/"/>
    
    <category term="OpenVPN" scheme="https://blog.rimuru.cc/tags/openvpn/"/>
    
    <category term="BBR" scheme="https://blog.rimuru.cc/tags/bbr/"/>
    
  </entry>
  
  <entry>
    <title>Hexo博客智能推荐阅读功能：基于OpenAI Embedding的实现</title>
    <link href="https://blog.rimuru.cc/2026/01/03/Hexo%E5%8D%9A%E5%AE%A2%E6%99%BA%E8%83%BD%E6%8E%A8%E8%8D%90%E9%98%85%E8%AF%BB%E5%8A%9F%E8%83%BD%EF%BC%9A%E5%9F%BA%E4%BA%8EOpenAI-Embedding%E7%9A%84%E5%AE%9E%E7%8E%B0/"/>
    <id>https://blog.rimuru.cc/2026/01/03/Hexo%E5%8D%9A%E5%AE%A2%E6%99%BA%E8%83%BD%E6%8E%A8%E8%8D%90%E9%98%85%E8%AF%BB%E5%8A%9F%E8%83%BD%EF%BC%9A%E5%9F%BA%E4%BA%8EOpenAI-Embedding%E7%9A%84%E5%AE%9E%E7%8E%B0/</id>
    <published>2026-01-03T18:45:00.000Z</published>
    <updated>2026-01-06T21:28:54.000Z</updated>
    
    <content type="html"><![CDATA[<p>在浏览博客时，「推荐阅读」功能能够有效提升用户体验，帮助读者发现更多感兴趣的内容。本文将介绍如何为 Hexo 博客实现一个智能推荐阅读功能，它利用 OpenAI 的 Embedding 技术来计算文章之间的语义相似度，从而实现精准的内容推荐。</p><h2 id="更新日志"><a href="#更新日志" class="headerlink" title="更新日志"></a>更新日志</h2><p>2026-01-04</p><ul><li>fix: 修复手机模式下推荐文章标题div宽度溢出的问题</li><li>chore: 长标题先尝试缩小字体，如果还是无法显示则截断并显示”…”.</li></ul><h2 id="功能概述"><a href="#功能概述" class="headerlink" title="功能概述"></a>功能概述</h2><p>整个推荐系统由两个核心脚本组成：</p><ol><li><p><strong><code>generate-posts-data.js</code></strong>：Hexo Generator 脚本，在博客构建时运行，负责生成文章数据和计算推荐</p></li><li><p><strong><code>recommended-posts.js</code></strong>：前端脚本，负责在页面上展示推荐文章</p></li></ol><blockquote><p>💡 <strong>提示</strong>：<a href="#%E9%85%8D%E7%BD%AE%E4%B8%8E%E4%BD%BF%E7%94%A8">配置与使用</a>折叠区域中提供了<strong>完整的脚本代码</strong>，可以直接复制使用。</p></blockquote><h3 id="工作流程"><a href="#工作流程" class="headerlink" title="工作流程"></a>工作流程</h3><p><img src="/2026/01/03/Hexo%E5%8D%9A%E5%AE%A2%E6%99%BA%E8%83%BD%E6%8E%A8%E8%8D%90%E9%98%85%E8%AF%BB%E5%8A%9F%E8%83%BD%EF%BC%9A%E5%9F%BA%E4%BA%8EOpenAI-Embedding%E7%9A%84%E5%AE%9E%E7%8E%B0/%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png" alt="工作流程"></p><h2 id="构建脚本：generate-posts-data-js"><a href="#构建脚本：generate-posts-data-js" class="headerlink" title="构建脚本：generate-posts-data.js"></a>构建脚本：generate-posts-data.js</h2><p>这个脚本注册为 Hexo Generator，在每次构建时自动运行。</p><h3 id="核心功能"><a href="#核心功能" class="headerlink" title="核心功能"></a>核心功能</h3><h4 id="1-环境变量读取"><a href="#1-环境变量读取" class="headerlink" title="1. 环境变量读取"></a>1. 环境变量读取</h4><div class="collapse-box-control">    <div class="collapse-box-header"><div class="collapse-box-icon"><i class="fa fa-plus"></i></div><span>代码</span></div>    <div class="collapse-box-content"><div class="inner">        <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getEnv</span>(<span class="params">key</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">env</span>[key]) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> process.<span class="property">env</span>[key];</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> envPath = path.<span class="title function_">join</span>(hexo.<span class="property">base_dir</span>, <span class="string">&#x27;.env&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (fs.<span class="title function_">existsSync</span>(envPath)) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> envContent = fs.<span class="title function_">readFileSync</span>(envPath, <span class="string">&#x27;utf-8&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> match = envContent.<span class="title function_">match</span>(<span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">`^<span class="subst">$&#123;key&#125;</span>=(.*)$`</span>, <span class="string">&#x27;m&#x27;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (match) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> match[<span class="number">1</span>].<span class="title function_">trim</span>();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>     </div></div>    </div><p>支持从环境变量或 <code>.env</code> 文件读取配置，需要的环境变量包括：</p><p><code>OPENAI_API_KEY</code>: OpenAI API 密钥</p><p><code>OPENAI_BASE_URL</code>: API 端点（可选，支持代理）</p><p><code>OPENAI_EMBEDDING_MODEL</code>: Embedding 模型名称</p><h4 id="2-内容预处理"><a href="#2-内容预处理" class="headerlink" title="2. 内容预处理"></a>2. 内容预处理</h4><div class="collapse-box-control">    <div class="collapse-box-header"><div class="collapse-box-icon"><i class="fa fa-plus"></i></div><span>代码</span></div>    <div class="collapse-box-content"><div class="inner">        <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">stripFrontMatter</span>(<span class="params">content</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (content.<span class="title function_">startsWith</span>(<span class="string">&#x27;---&#x27;</span>)) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> end = content.<span class="title function_">indexOf</span>(<span class="string">&#x27;---&#x27;</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (end !== -<span class="number">1</span>) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> content.<span class="title function_">substring</span>(end + <span class="number">3</span>).<span class="title function_">trim</span>();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> content;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>     </div></div>    </div><p>移除文章的 Front Matter，只保留正文内容用于 Embedding 计算。</p><h4 id="3-Embedding-获取与缓存"><a href="#3-Embedding-获取与缓存" class="headerlink" title="3. Embedding 获取与缓存"></a>3. Embedding 获取与缓存</h4><p>脚本实现了智能缓存机制：</p><ol><li><p>计算文章内容的 MD5 哈希值</p></li><li><p>检查缓存中是否存在相同哈希的 Embedding</p></li><li><p>如果缓存命中则复用，否则调用 API 获取新的 Embedding</p></li><li><p>将新获取的 Embedding 保存到 <code>embeddings_store/cache.json</code></p></li></ol><p>这种设计大大减少了 API 调用次数，只有文章内容发生变化时才会重新计算 Embedding。</p><h4 id="4-相似度计算"><a href="#4-相似度计算" class="headerlink" title="4. 相似度计算"></a>4. 相似度计算</h4><div class="collapse-box-control">    <div class="collapse-box-header"><div class="collapse-box-icon"><i class="fa fa-plus"></i></div><span>代码</span></div>    <div class="collapse-box-content"><div class="inner">        <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">cosineSimilarity</span>(<span class="params">vecA, vecB</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> dotProduct = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> normA = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> normB = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; vecA.<span class="property">length</span>; i++) &#123;</span><br><span class="line"></span><br><span class="line">    dotProduct += vecA[i] * vecB[i];</span><br><span class="line"></span><br><span class="line">    normA += vecA[i] * vecA[i];</span><br><span class="line"></span><br><span class="line">    normB += vecB[i] * vecB[i];</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> dotProduct / (<span class="title class_">Math</span>.<span class="title function_">sqrt</span>(normA) * <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(normB));</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>     </div></div>    </div><p>使用余弦相似度来衡量两篇文章的语义相关性，这是文本相似度计算中最常用的方法。</p><h4 id="5-生成数据文件"><a href="#5-生成数据文件" class="headerlink" title="5. 生成数据文件"></a>5. 生成数据文件</h4><p>脚本会生成两种类型的 JSON 文件：</p><p><strong>单篇文章数据</strong> (<code>js/posts-data/&#123;post-path&#125;.json</code>)：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;文章标题&quot;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024/01/01/post-slug/&quot;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-01-01T00:00:00.000Z&quot;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">&quot;categories&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;分类1&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">&quot;tags&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;标签1&quot;</span><span class="punctuation">,</span> <span class="string">&quot;标签2&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">&quot;recommendations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line"></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;推荐文章1&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;...&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;...&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;similarity&quot;</span><span class="punctuation">:</span> <span class="number">0.95</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;推荐文章2&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;...&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;...&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;similarity&quot;</span><span class="punctuation">:</span> <span class="number">0.90</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>索引文件</strong> (<code>js/posts-data/index.json</code>)：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="punctuation">[</span></span><br><span class="line"></span><br><span class="line">  <span class="punctuation">&#123;</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;文章1&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;...&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;...&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;dataFile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;...&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">  <span class="punctuation">&#123;</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;文章2&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;...&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;...&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;dataFile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;...&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="前端脚本：recommended-posts-js"><a href="#前端脚本：recommended-posts-js" class="headerlink" title="前端脚本：recommended-posts.js"></a>前端脚本：recommended-posts.js</h2><p>这个脚本在浏览器中运行，负责展示推荐文章。</p><h3 id="核心功能-1"><a href="#核心功能-1" class="headerlink" title="核心功能"></a>核心功能</h3><h4 id="1-页面类型检测"><a href="#1-页面类型检测" class="headerlink" title="1. 页面类型检测"></a>1. 页面类型检测</h4><div class="collapse-box-control">    <div class="collapse-box-header"><div class="collapse-box-icon"><i class="fa fa-plus"></i></div><span>代码</span></div>    <div class="collapse-box-content"><div class="inner">        <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isPostPage</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> path = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">pathname</span>;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  <span class="comment">// 排除首页、分页、分类、标签、归档等页面</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (path === <span class="string">&#x27;/&#x27;</span> || <span class="regexp">/^\/page\/\d+\/?$/</span>.<span class="title function_">test</span>(path)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (path.<span class="title function_">startsWith</span>(<span class="string">&#x27;/categories&#x27;</span>) || path.<span class="title function_">startsWith</span>(<span class="string">&#x27;/tags&#x27;</span>)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (path.<span class="title function_">startsWith</span>(<span class="string">&#x27;/archives&#x27;</span>)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  <span class="comment">// 检查文章特有元素</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> hasArticle = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;article[itemtype*=&quot;Article&quot;]&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> hasPostClass = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.kratos-page-inner.kr-post&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> hasArticle || hasPostClass;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>     </div></div>    </div><p>只在文章页面显示推荐阅读，避免在首页和列表页出现。</p><h4 id="2-推荐策略"><a href="#2-推荐策略" class="headerlink" title="2. 推荐策略"></a>2. 推荐策略</h4><p>脚本采用<strong>优雅降级</strong>策略：</p><ol><li><p><strong>优先使用预计算推荐</strong>：加载当前文章的数据文件，使用其中的 <code>recommendations</code> 字段</p></li><li><p><strong>随机补齐</strong>：如果推荐数量不足，从索引中随机抽取文章补充</p></li><li><p><strong>完全随机降级</strong>：如果数据文件不存在，则完全从索引中随机选择</p></li></ol><div class="collapse-box-control">    <div class="collapse-box-header"><div class="collapse-box-icon"><i class="fa fa-plus"></i></div><span>代码</span></div>    <div class="collapse-box-content"><div class="inner">        <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">if</span> (postData?.<span class="property">recommendations</span>?.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用预计算推荐 + 随机补齐</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> numFromRecommendations = <span class="title class_">Math</span>.<span class="title function_">min</span>(postData.<span class="property">recommendations</span>.<span class="property">length</span>, <span class="variable constant_">CONFIG</span>.<span class="property">numRecommended</span> - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  recommended = postData.<span class="property">recommendations</span>.<span class="title function_">slice</span>(<span class="number">0</span>, numFromRecommendations);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ... 随机补齐逻辑</span></span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (indexData?.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 降级：完全随机</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> shuffled = <span class="title function_">shuffleArray</span>(indexData);</span><br><span class="line"></span><br><span class="line">  recommended = shuffled.<span class="title function_">slice</span>(<span class="number">0</span>, <span class="variable constant_">CONFIG</span>.<span class="property">numRecommended</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>     </div></div>    </div><h4 id="3-样式注入"><a href="#3-样式注入" class="headerlink" title="3. 样式注入"></a>3. 样式注入</h4><p>脚本自带完整的 CSS 样式，无需额外引入样式文件：</p><ul><li><p>支持亮色&#x2F;暗色主题（通过 CSS 变量）</p></li><li><p>响应式设计，适配移动端</p></li><li><p>平滑的悬浮动画效果</p></li></ul><h4 id="4-PJAX-支持"><a href="#4-PJAX-支持" class="headerlink" title="4. PJAX 支持"></a>4. PJAX 支持</h4><div class="collapse-box-control">    <div class="collapse-box-header"><div class="collapse-box-icon"><i class="fa fa-plus"></i></div><span>代码</span></div>    <div class="collapse-box-content"><div class="inner">        <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setupPjaxSupport</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;pjax:complete&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> existing = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.recommended-posts&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (existing) existing.<span class="title function_">remove</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">init</span>();</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>     </div></div>    </div><p>完美支持 PJAX 局部刷新，在页面切换时自动更新推荐列表。</p><h2 id="配置与使用"><a href="#配置与使用" class="headerlink" title="配置与使用"></a>配置与使用</h2><h3 id="1-安装脚本"><a href="#1-安装脚本" class="headerlink" title="1. 安装脚本"></a>1. 安装脚本</h3><p>将 <code>generate-posts-data.js</code> 放置在 Hexo 项目的 <code>scripts/</code> 目录下。</p><p>将 <code>recommended-posts.js</code> 放置在 <code>source/js/</code> 目录下。</p><p>在主题中引入 <code>recommended-posts.js</code>，创建或修改博客项目的 <code>_config.Kratos-Rebirth.yml</code> 文件，添加如下配置：</p><blockquote><p>💡 <strong>提示</strong>：本文博客使用 Kratos-Rebirth 主题，引入部分参考自己的主题进行配置。</p></blockquote><div class="collapse-box-control">    <div class="collapse-box-header"><div class="collapse-box-icon"><i class="fa fa-plus"></i></div><span>generate-posts-data.js</span></div>    <div class="collapse-box-content"><div class="inner">        <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> * 生成文章数据 JSON 文件</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> * 用于推荐阅读功能</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> * 包含文章内容的 MD5 和 Embedding</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> * 并计算 Top 5 相关文章</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> https = <span class="built_in">require</span>(<span class="string">&#x27;https&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取环境变量</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getEnv</span>(<span class="params">key</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">env</span>[key]) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> process.<span class="property">env</span>[key];</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> envPath = path.<span class="title function_">join</span>(hexo.<span class="property">base_dir</span>, <span class="string">&#x27;.env&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (fs.<span class="title function_">existsSync</span>(envPath)) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> envContent = fs.<span class="title function_">readFileSync</span>(envPath, <span class="string">&#x27;utf-8&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> match = envContent.<span class="title function_">match</span>(<span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">`^<span class="subst">$&#123;key&#125;</span>=(.*)$`</span>, <span class="string">&#x27;m&#x27;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (match) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> match[<span class="number">1</span>].<span class="title function_">trim</span>();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 移除 Front Matter</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">stripFrontMatter</span>(<span class="params">content</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (content.<span class="title function_">startsWith</span>(<span class="string">&#x27;---&#x27;</span>)) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> end = content.<span class="title function_">indexOf</span>(<span class="string">&#x27;---&#x27;</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (end !== -<span class="number">1</span>) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> content.<span class="title function_">substring</span>(end + <span class="number">3</span>).<span class="title function_">trim</span>();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> content;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 计算 MD5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">calculateMD5</span>(<span class="params">content</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> crypto.<span class="title function_">createHash</span>(<span class="string">&#x27;md5&#x27;</span>).<span class="title function_">update</span>(content).<span class="title function_">digest</span>(<span class="string">&#x27;hex&#x27;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 计算余弦相似度</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">cosineSimilarity</span>(<span class="params">vecA, vecB</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> dotProduct = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> normA = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> normB = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; vecA.<span class="property">length</span>; i++) &#123;</span><br><span class="line"></span><br><span class="line">    dotProduct += vecA[i] * vecB[i];</span><br><span class="line"></span><br><span class="line">    normA += vecA[i] * vecA[i];</span><br><span class="line"></span><br><span class="line">    normB += vecB[i] * vecB[i];</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> dotProduct / (<span class="title class_">Math</span>.<span class="title function_">sqrt</span>(normA) * <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(normB));</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用 OpenAI API 获取 Embedding</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getEmbedding</span>(<span class="params">text, apiKey, endpoint, model</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> baseUrl = endpoint ? endpoint.<span class="title function_">replace</span>(<span class="regexp">/\/+$/</span>, <span class="string">&#x27;&#x27;</span>) : <span class="string">&#x27;https://api.openai.com/v1&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> url = <span class="keyword">new</span> <span class="title function_">URL</span>(<span class="string">`<span class="subst">$&#123;baseUrl&#125;</span>/embeddings`</span>);</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> postData = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line"></span><br><span class="line">      <span class="attr">input</span>: text,</span><br><span class="line"></span><br><span class="line">      <span class="attr">model</span>: model</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> options = &#123;</span><br><span class="line"></span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line"></span><br><span class="line">      <span class="attr">headers</span>: &#123;</span><br><span class="line"></span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line"></span><br><span class="line">        <span class="string">&#x27;Authorization&#x27;</span>: <span class="string">`Bearer <span class="subst">$&#123;apiKey&#125;</span>`</span>,</span><br><span class="line"></span><br><span class="line">        <span class="string">&#x27;Content-Length&#x27;</span>: <span class="title class_">Buffer</span>.<span class="title function_">byteLength</span>(postData)</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> requestModule = url.<span class="property">protocol</span> === <span class="string">&#x27;http:&#x27;</span> ? <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>) : https;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> req = requestModule.<span class="title function_">request</span>(url, options, <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> data = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">      res.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> data += chunk);</span><br><span class="line"></span><br><span class="line">      res.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">statusCode</span> &gt;= <span class="number">200</span> &amp;&amp; res.<span class="property">statusCode</span> &lt; <span class="number">300</span>) &#123;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> parsed = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (parsed.<span class="property">data</span> &amp;&amp; parsed.<span class="property">data</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">              <span class="title function_">resolve</span>(parsed.<span class="property">data</span>[<span class="number">0</span>].<span class="property">embedding</span>);</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">              <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Invalid API response: missing embedding data&#x27;</span>));</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">          &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`JSON parse error: <span class="subst">$&#123;e.message&#125;</span>`</span>));</span><br><span class="line"></span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 不要在错误信息中包含完整响应，可能包含敏感信息</span></span><br><span class="line"></span><br><span class="line">          <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`API request failed with status <span class="subst">$&#123;res.statusCode&#125;</span>`</span>));</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    req.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> <span class="title function_">reject</span>(e));</span><br><span class="line"></span><br><span class="line">    req.<span class="title function_">write</span>(postData);</span><br><span class="line"></span><br><span class="line">    req.<span class="title function_">end</span>();</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hexo.<span class="property">extend</span>.<span class="property">generator</span>.<span class="title function_">register</span>(<span class="string">&#x27;posts-data&#x27;</span>, <span class="keyword">async</span> <span class="keyword">function</span>(<span class="params">locals</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> log = hexo.<span class="property">log</span> || <span class="variable language_">console</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> apiKey = <span class="title function_">getEnv</span>(<span class="string">&#x27;OPENAI_API_KEY&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> endpoint = <span class="title function_">getEnv</span>(<span class="string">&#x27;OPENAI_BASE_URL&#x27;</span>) || <span class="title function_">getEnv</span>(<span class="string">&#x27;OPENAI_API_ENDPOINT&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> model = <span class="title function_">getEnv</span>(<span class="string">&#x27;OPENAI_EMBEDDING_MODEL&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (apiKey &amp;&amp; !model) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Generate Posts Data: OPENAI_EMBEDDING_MODEL environment variable is required.&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!apiKey) &#123;</span><br><span class="line"></span><br><span class="line">    log.<span class="title function_">warn</span>(<span class="string">&#x27;Generate Posts Data: OPENAI_API_KEY usually required for embeddings, but not found. Recommendations will be random.&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 确保存储目录存在</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> storeDir = path.<span class="title function_">join</span>(hexo.<span class="property">base_dir</span>, <span class="string">&#x27;embeddings_store&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!fs.<span class="title function_">existsSync</span>(storeDir)) &#123;</span><br><span class="line"></span><br><span class="line">    fs.<span class="title function_">mkdirSync</span>(storeDir);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 加载缓存</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> cachePath = path.<span class="title function_">join</span>(storeDir, <span class="string">&#x27;cache.json&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> cache = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (fs.<span class="title function_">existsSync</span>(cachePath)) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">      cache = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(fs.<span class="title function_">readFileSync</span>(cachePath, <span class="string">&#x27;utf-8&#x27;</span>));</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line"></span><br><span class="line">      log.<span class="title function_">error</span>(<span class="string">&#x27;Generate Posts Data: Failed to load cache.&#x27;</span>, e);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> posts = locals.<span class="property">posts</span>.<span class="title function_">sort</span>(<span class="string">&#x27;-date&#x27;</span>).<span class="title function_">toArray</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> processedPosts = [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> cacheUpdated = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1. 获取/更新 Embeddings</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> post <span class="keyword">of</span> posts) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> rawContent = post.<span class="property">raw</span> || <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> body = <span class="title function_">stripFrontMatter</span>(rawContent);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> title = post.<span class="property">title</span> || <span class="string">&#x27;(无标题)&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 组合 Title 和 Body</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> contentForEmbedding = <span class="string">`Title: <span class="subst">$&#123;title&#125;</span>\n\n<span class="subst">$&#123;body&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 截断内容</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> truncatedContent = contentForEmbedding.<span class="title function_">slice</span>(<span class="number">0</span>, <span class="number">30000</span>); </span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> hash = <span class="title function_">calculateMD5</span>(truncatedContent);</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> embedding = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (cache[post.<span class="property">path</span>] &amp;&amp; cache[post.<span class="property">path</span>].<span class="property">hash</span> === hash) &#123;</span><br><span class="line"></span><br><span class="line">      embedding = cache[post.<span class="property">path</span>].<span class="property">embedding</span>;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (apiKey) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">        log.<span class="title function_">info</span>(<span class="string">`Generating embedding for: <span class="subst">$&#123;title&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">        embedding = <span class="keyword">await</span> <span class="title function_">getEmbedding</span>(truncatedContent, apiKey, endpoint, model);</span><br><span class="line"></span><br><span class="line">        cache[post.<span class="property">path</span>] = &#123;</span><br><span class="line"></span><br><span class="line">          <span class="attr">hash</span>: hash,</span><br><span class="line"></span><br><span class="line">          <span class="attr">embedding</span>: embedding</span><br><span class="line"></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        cacheUpdated = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line"></span><br><span class="line">        log.<span class="title function_">error</span>(<span class="string">`Failed to generate embedding for <span class="subst">$&#123;title&#125;</span>:`</span>, e.<span class="property">message</span>);</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    processedPosts.<span class="title function_">push</span>(&#123;</span><br><span class="line"></span><br><span class="line">      <span class="attr">post</span>: post,</span><br><span class="line"></span><br><span class="line">      <span class="attr">embedding</span>: embedding</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 保存缓存</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (cacheUpdated) &#123;</span><br><span class="line"></span><br><span class="line">    fs.<span class="title function_">writeFileSync</span>(cachePath, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(cache, <span class="literal">null</span>, <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. 计算相似度并生成最终数据</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> generatedFiles = [];</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  <span class="comment">// 用于存储所有文章的基本信息（用于回退/随机推荐）</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> indexData = [];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> processedPosts) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> currentPost = item.<span class="property">post</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> currentEmbedding = item.<span class="property">embedding</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> recommendations = [];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (currentEmbedding) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 计算与所有其他文章的相似度</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> candidates = processedPosts</span><br><span class="line"></span><br><span class="line">        .<span class="title function_">filter</span>(<span class="function"><span class="params">p</span> =&gt;</span> p.<span class="property">post</span>.<span class="property">path</span> !== currentPost.<span class="property">path</span> &amp;&amp; p.<span class="property">embedding</span>) <span class="comment">// 排除自己且必须有embedding</span></span><br><span class="line"></span><br><span class="line">        .<span class="title function_">map</span>(<span class="function"><span class="params">p</span> =&gt;</span> (&#123;</span><br><span class="line"></span><br><span class="line">          <span class="attr">title</span>: p.<span class="property">post</span>.<span class="property">title</span>,</span><br><span class="line"></span><br><span class="line">          <span class="attr">path</span>: p.<span class="property">post</span>.<span class="property">path</span>,</span><br><span class="line"></span><br><span class="line">          <span class="attr">date</span>: p.<span class="property">post</span>.<span class="property">date</span>.<span class="title function_">toISOString</span>(),</span><br><span class="line"></span><br><span class="line">          <span class="attr">similarity</span>: <span class="title function_">cosineSimilarity</span>(currentEmbedding, p.<span class="property">embedding</span>)</span><br><span class="line"></span><br><span class="line">        &#125;))</span><br><span class="line"></span><br><span class="line">        .<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> b.<span class="property">similarity</span> - a.<span class="property">similarity</span>) <span class="comment">// 降序</span></span><br><span class="line"></span><br><span class="line">        .<span class="title function_">slice</span>(<span class="number">0</span>, <span class="number">5</span>); <span class="comment">// 取前5</span></span><br><span class="line"></span><br><span class="line">      </span><br><span class="line"></span><br><span class="line">      recommendations = candidates;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构建单篇文章的数据对象</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> postData = &#123;</span><br><span class="line"></span><br><span class="line">      <span class="attr">title</span>: currentPost.<span class="property">title</span> || <span class="string">&#x27;(无标题)&#x27;</span>,</span><br><span class="line"></span><br><span class="line">      <span class="attr">path</span>: currentPost.<span class="property">path</span>,</span><br><span class="line"></span><br><span class="line">      <span class="attr">date</span>: currentPost.<span class="property">date</span>.<span class="title function_">toISOString</span>(),</span><br><span class="line"></span><br><span class="line">      <span class="attr">categories</span>: currentPost.<span class="property">categories</span>?.<span class="title function_">map</span>(<span class="function"><span class="params">cat</span> =&gt;</span> cat.<span class="property">name</span>) || [],</span><br><span class="line"></span><br><span class="line">      <span class="attr">tags</span>: currentPost.<span class="property">tags</span>?.<span class="title function_">map</span>(<span class="function"><span class="params">tag</span> =&gt;</span> tag.<span class="property">name</span>) || [],</span><br><span class="line"></span><br><span class="line">      <span class="attr">recommendations</span>: recommendations <span class="comment">// 包含 Top 5</span></span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 生成文件路径：将 path 转换为安全的文件名</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 例如 &quot;2024/01/01/my-post/&quot; -&gt; &quot;2024-01-01-my-post.json&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> safeFileName = currentPost.<span class="property">path</span></span><br><span class="line"></span><br><span class="line">      .<span class="title function_">replace</span>(<span class="regexp">/^\/+|\/+$/g</span>, <span class="string">&#x27;&#x27;</span>) <span class="comment">// 移除首尾斜杠</span></span><br><span class="line"></span><br><span class="line">      .<span class="title function_">replace</span>(<span class="regexp">/\//g</span>, <span class="string">&#x27;-&#x27;</span>) <span class="comment">// 替换斜杠为连字符</span></span><br><span class="line"></span><br><span class="line">      .<span class="title function_">replace</span>(<span class="regexp">/\.html?$/</span>, <span class="string">&#x27;&#x27;</span>) <span class="comment">// 移除 .html 后缀</span></span><br><span class="line"></span><br><span class="line">      + <span class="string">&#x27;.json&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加到生成文件列表</span></span><br><span class="line"></span><br><span class="line">    generatedFiles.<span class="title function_">push</span>(&#123;</span><br><span class="line"></span><br><span class="line">      <span class="attr">path</span>: <span class="string">`js/posts-data/<span class="subst">$&#123;safeFileName&#125;</span>`</span>,</span><br><span class="line"></span><br><span class="line">      <span class="attr">data</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(postData)</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加到索引（简化版，用于回退和随机推荐）</span></span><br><span class="line"></span><br><span class="line">    indexData.<span class="title function_">push</span>(&#123;</span><br><span class="line"></span><br><span class="line">      <span class="attr">title</span>: postData.<span class="property">title</span>,</span><br><span class="line"></span><br><span class="line">      <span class="attr">path</span>: postData.<span class="property">path</span>,</span><br><span class="line"></span><br><span class="line">      <span class="attr">date</span>: postData.<span class="property">date</span>,</span><br><span class="line"></span><br><span class="line">      <span class="attr">dataFile</span>: safeFileName <span class="comment">// 指向单独的数据文件</span></span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 添加索引文件</span></span><br><span class="line"></span><br><span class="line">  generatedFiles.<span class="title function_">push</span>(&#123;</span><br><span class="line"></span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;js/posts-data/index.json&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="attr">data</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(indexData)</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> generatedFiles;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>     </div></div>    </div><div class="collapse-box-control">    <div class="collapse-box-header"><div class="collapse-box-icon"><i class="fa fa-plus"></i></div><span>recommended-posts.js</span></div>    <div class="collapse-box-content"><div class="inner">        <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 推荐阅读功能</span></span><br><span class="line"><span class="comment"> * 在文章页面随机展示推荐文章</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 配置项</span></span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">CONFIG</span> = &#123;</span><br><span class="line">    <span class="attr">numRecommended</span>: <span class="number">5</span>,           <span class="comment">// 推荐文章数量</span></span><br><span class="line">    <span class="attr">containerSelector</span>: <span class="string">&#x27;.post-navigation&#x27;</span>, <span class="comment">// 插入位置（在导航后面）</span></span><br><span class="line">    <span class="attr">fallbackSelector</span>: <span class="string">&#x27;.kratos-entry-footer&#x27;</span>, <span class="comment">// 备用插入位置</span></span><br><span class="line">    <span class="attr">dataBasePath</span>: <span class="string">&#x27;/js/posts-data/&#x27;</span>, <span class="comment">// 文章数据基础路径</span></span><br><span class="line">    <span class="attr">indexPath</span>: <span class="string">&#x27;/js/posts-data/index.json&#x27;</span> <span class="comment">// 索引文件路径</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 注入样式</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">injectStyles</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> style = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;style&#x27;</span>);</span><br><span class="line">    style.<span class="property">textContent</span> = <span class="string">`</span></span><br><span class="line"><span class="string">      .recommended-posts &#123;</span></span><br><span class="line"><span class="string">        background: var(--kr-theme-card-bg, #ffffffcc);</span></span><br><span class="line"><span class="string">        border-radius: 8px;</span></span><br><span class="line"><span class="string">        padding: 20px 25px;</span></span><br><span class="line"><span class="string">        margin: 20px 0;</span></span><br><span class="line"><span class="string">        box-shadow: 0 2px 12px rgba(0,0,0,0.08);</span></span><br><span class="line"><span class="string">        transition: all 0.3s ease;</span></span><br><span class="line"><span class="string">        overflow: hidden;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">      .recommended-posts:hover &#123;</span></span><br><span class="line"><span class="string">        box-shadow: 0 4px 20px rgba(0,0,0,0.12);</span></span><br><span class="line"><span class="string">        transform: translateY(-2px);</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">      .recommended-posts-title &#123;</span></span><br><span class="line"><span class="string">        display: flex;</span></span><br><span class="line"><span class="string">        align-items: center;</span></span><br><span class="line"><span class="string">        gap: 10px;</span></span><br><span class="line"><span class="string">        font-size: 1.1rem;</span></span><br><span class="line"><span class="string">        font-weight: 600;</span></span><br><span class="line"><span class="string">        color: var(--kr-theme-text, #000);</span></span><br><span class="line"><span class="string">        margin-bottom: 15px;</span></span><br><span class="line"><span class="string">        padding-bottom: 12px;</span></span><br><span class="line"><span class="string">        border-bottom: 2px solid var(--kr-theme-link, #1e8cdb);</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">      .recommended-posts-title i &#123;</span></span><br><span class="line"><span class="string">        color: var(--kr-theme-link, #1e8cdb);</span></span><br><span class="line"><span class="string">        font-size: 1.2rem;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">      .recommended-posts-list &#123;</span></span><br><span class="line"><span class="string">        list-style: none;</span></span><br><span class="line"><span class="string">        padding: 0;</span></span><br><span class="line"><span class="string">        margin: 0;</span></span><br><span class="line"><span class="string">        display: grid;</span></span><br><span class="line"><span class="string">        gap: 10px;</span></span><br><span class="line"><span class="string">        overflow: hidden;</span></span><br><span class="line"><span class="string">        width: 100%;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">      .recommended-posts-item &#123;</span></span><br><span class="line"><span class="string">        position: relative;</span></span><br><span class="line"><span class="string">        padding-left: 0;</span></span><br><span class="line"><span class="string">        transition: all 0.2s ease;</span></span><br><span class="line"><span class="string">        overflow: hidden;</span></span><br><span class="line"><span class="string">        min-width: 0;</span></span><br><span class="line"><span class="string">        max-width: 100%;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">      .recommended-posts-item a &#123;</span></span><br><span class="line"><span class="string">        display: flex;</span></span><br><span class="line"><span class="string">        align-items: center;</span></span><br><span class="line"><span class="string">        gap: 12px;</span></span><br><span class="line"><span class="string">        padding: 12px 15px;</span></span><br><span class="line"><span class="string">        background: var(--kr-theme-info-bg, #e0e0e0aa);</span></span><br><span class="line"><span class="string">        border-radius: 6px;</span></span><br><span class="line"><span class="string">        color: var(--kr-theme-text, #000);</span></span><br><span class="line"><span class="string">        text-decoration: none;</span></span><br><span class="line"><span class="string">        transition: all 0.25s ease;</span></span><br><span class="line"><span class="string">        border-left: 3px solid transparent;</span></span><br><span class="line"><span class="string">        overflow: hidden;</span></span><br><span class="line"><span class="string">        min-width: 0;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">      .recommended-posts-item a:hover &#123;</span></span><br><span class="line"><span class="string">        background: var(--kr-theme-link, #1e8cdb);</span></span><br><span class="line"><span class="string">        color: #fff;</span></span><br><span class="line"><span class="string">        border-left-color: var(--kr-theme-link-hover, #6ec3f5);</span></span><br><span class="line"><span class="string">        transform: translateX(5px);</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">      .recommended-posts-item a i &#123;</span></span><br><span class="line"><span class="string">        font-size: 0.9rem;</span></span><br><span class="line"><span class="string">        opacity: 0.8;</span></span><br><span class="line"><span class="string">        flex-shrink: 0;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">      .recommended-posts-item a:hover i &#123;</span></span><br><span class="line"><span class="string">        opacity: 1;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">      .recommended-posts-item .post-title-text &#123;</span></span><br><span class="line"><span class="string">        flex: 1;</span></span><br><span class="line"><span class="string">        min-width: 0;</span></span><br><span class="line"><span class="string">        overflow: hidden;</span></span><br><span class="line"><span class="string">        text-overflow: ellipsis;</span></span><br><span class="line"><span class="string">        white-space: nowrap;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">      .recommended-posts-item .post-date &#123;</span></span><br><span class="line"><span class="string">        font-size: 0.8rem;</span></span><br><span class="line"><span class="string">        opacity: 0.7;</span></span><br><span class="line"><span class="string">        flex-shrink: 0;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">      .recommended-posts-loading &#123;</span></span><br><span class="line"><span class="string">        text-align: center;</span></span><br><span class="line"><span class="string">        padding: 20px;</span></span><br><span class="line"><span class="string">        color: var(--kr-theme-text-alt, #666);</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">      .recommended-posts-empty &#123;</span></span><br><span class="line"><span class="string">        text-align: center;</span></span><br><span class="line"><span class="string">        padding: 15px;</span></span><br><span class="line"><span class="string">        color: var(--kr-theme-text-alt, #666);</span></span><br><span class="line"><span class="string">        font-style: italic;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">      /* 响应式适配 */</span></span><br><span class="line"><span class="string">      @media (max-width: 768px) &#123;</span></span><br><span class="line"><span class="string">        .recommended-posts &#123;</span></span><br><span class="line"><span class="string">          padding: 15px 18px;</span></span><br><span class="line"><span class="string">          margin: 15px 0;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        .recommended-posts-item a &#123;</span></span><br><span class="line"><span class="string">          padding: 10px 12px;</span></span><br><span class="line"><span class="string">          gap: 8px;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        .recommended-posts-item .post-title-text &#123;</span></span><br><span class="line"><span class="string">          font-size: 0.9rem;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        .recommended-posts-item .post-date &#123;</span></span><br><span class="line"><span class="string">          display: none;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">appendChild</span>(style);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取当前页面路径</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">getCurrentPath</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">pathname</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Fisher-Yates 洗牌算法</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">shuffleArray</span>(<span class="params">array</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> shuffled = [...array];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = shuffled.<span class="property">length</span> - <span class="number">1</span>; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">      <span class="keyword">const</span> j = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * (i + <span class="number">1</span>));</span><br><span class="line">      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> shuffled;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 格式化日期</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">formatDate</span>(<span class="params">dateStr</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>(dateStr);</span><br><span class="line">    <span class="keyword">const</span> year = date.<span class="title function_">getFullYear</span>();</span><br><span class="line">    <span class="keyword">const</span> month = <span class="title class_">String</span>(date.<span class="title function_">getMonth</span>() + <span class="number">1</span>).<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> day = <span class="title class_">String</span>(date.<span class="title function_">getDate</span>()).<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;year&#125;</span>-<span class="subst">$&#123;month&#125;</span>-<span class="subst">$&#123;day&#125;</span>`</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 创建推荐阅读容器</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">createContainer</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> container = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">    container.<span class="property">className</span> = <span class="string">&#x27;recommended-posts&#x27;</span>;</span><br><span class="line">    container.<span class="property">innerHTML</span> = <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;div class=&quot;recommended-posts-title&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;i class=&quot;fa fa-star&quot;&gt;&lt;/i&gt;</span></span><br><span class="line"><span class="string">        &lt;span&gt;推荐阅读&lt;/span&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;div class=&quot;recommended-posts-loading&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;i class=&quot;fa fa-spinner fa-spin&quot;&gt;&lt;/i&gt; 加载中...</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line">    <span class="keyword">return</span> container;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 将路径转换为数据文件名</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">pathToDataFileName</span>(<span class="params">path</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> path</span><br><span class="line">      .<span class="title function_">replace</span>(<span class="regexp">/^\/+|\/+$/g</span>, <span class="string">&#x27;&#x27;</span>) <span class="comment">// 移除首尾斜杠</span></span><br><span class="line">      .<span class="title function_">replace</span>(<span class="regexp">/\//g</span>, <span class="string">&#x27;-&#x27;</span>) <span class="comment">// 替换斜杠为连字符</span></span><br><span class="line">      .<span class="title function_">replace</span>(<span class="regexp">/\.html?$/</span>, <span class="string">&#x27;&#x27;</span>) <span class="comment">// 移除 .html 后缀</span></span><br><span class="line">      + <span class="string">&#x27;.json&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 渲染推荐文章列表</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">renderPosts</span>(<span class="params">container, postData, indexData</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> currentPath = <span class="title function_">getCurrentPath</span>();</span><br><span class="line">    <span class="keyword">const</span> normalizedCurrentPath = currentPath.<span class="title function_">replace</span>(<span class="regexp">/^\//</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> recommended = [];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 尝试使用当前文章的预计算推荐</span></span><br><span class="line">    <span class="keyword">if</span> (postData &amp;&amp; postData.<span class="property">recommendations</span> &amp;&amp; postData.<span class="property">recommendations</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">// 从 recommendations 中取前 numRecommended - 1 个</span></span><br><span class="line">      <span class="keyword">const</span> numFromRecommendations = <span class="title class_">Math</span>.<span class="title function_">min</span>(postData.<span class="property">recommendations</span>.<span class="property">length</span>, <span class="variable constant_">CONFIG</span>.<span class="property">numRecommended</span> - <span class="number">1</span>);</span><br><span class="line">      recommended = postData.<span class="property">recommendations</span>.<span class="title function_">slice</span>(<span class="number">0</span>, numFromRecommendations);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 从索引中随机补齐剩余位置</span></span><br><span class="line">      <span class="keyword">if</span> (indexData &amp;&amp; indexData.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> selectedPaths = <span class="keyword">new</span> <span class="title class_">Set</span>(recommended.<span class="title function_">map</span>(<span class="function"><span class="params">p</span> =&gt;</span> p.<span class="property">path</span>));</span><br><span class="line">        selectedPaths.<span class="title function_">add</span>(normalizedCurrentPath);</span><br><span class="line">        selectedPaths.<span class="title function_">add</span>(currentPath);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">const</span> remaining = <span class="variable constant_">CONFIG</span>.<span class="property">numRecommended</span> - recommended.<span class="property">length</span>;</span><br><span class="line">        <span class="keyword">if</span> (remaining &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="keyword">const</span> pool = indexData.<span class="title function_">filter</span>(<span class="function"><span class="params">p</span> =&gt;</span> !selectedPaths.<span class="title function_">has</span>(p.<span class="property">path</span>));</span><br><span class="line">          <span class="keyword">const</span> shuffled = <span class="title function_">shuffleArray</span>(pool);</span><br><span class="line">          <span class="keyword">const</span> extra = shuffled.<span class="title function_">slice</span>(<span class="number">0</span>, remaining);</span><br><span class="line">          recommended = recommended.<span class="title function_">concat</span>(extra);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (indexData &amp;&amp; indexData.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">// 2. 降级方案：从索引中随机抽取</span></span><br><span class="line">      <span class="keyword">const</span> filteredPosts = indexData.<span class="title function_">filter</span>(<span class="function"><span class="params">post</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> postPath = post.<span class="property">path</span>.<span class="title function_">startsWith</span>(<span class="string">&#x27;/&#x27;</span>) ? post.<span class="property">path</span> : <span class="string">&#x27;/&#x27;</span> + post.<span class="property">path</span>;</span><br><span class="line">        <span class="keyword">return</span> postPath !== currentPath &amp;&amp; !currentPath.<span class="title function_">endsWith</span>(post.<span class="property">path</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">const</span> shuffled = <span class="title function_">shuffleArray</span>(filteredPosts);</span><br><span class="line">      recommended = shuffled.<span class="title function_">slice</span>(<span class="number">0</span>, <span class="variable constant_">CONFIG</span>.<span class="property">numRecommended</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 清除加载状态</span></span><br><span class="line">    <span class="keyword">const</span> loading = container.<span class="title function_">querySelector</span>(<span class="string">&#x27;.recommended-posts-loading&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (loading) loading.<span class="title function_">remove</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 如果没有推荐文章</span></span><br><span class="line">    <span class="keyword">if</span> (recommended.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> empty = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">      empty.<span class="property">className</span> = <span class="string">&#x27;recommended-posts-empty&#x27;</span>;</span><br><span class="line">      empty.<span class="property">textContent</span> = <span class="string">&#x27;暂无推荐文章&#x27;</span>;</span><br><span class="line">      container.<span class="title function_">appendChild</span>(empty);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建列表</span></span><br><span class="line">    <span class="keyword">const</span> list = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;ul&#x27;</span>);</span><br><span class="line">    list.<span class="property">className</span> = <span class="string">&#x27;recommended-posts-list&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    recommended.<span class="title function_">forEach</span>(<span class="function"><span class="params">post</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> item = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;li&#x27;</span>);</span><br><span class="line">      item.<span class="property">className</span> = <span class="string">&#x27;recommended-posts-item&#x27;</span>;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">const</span> link = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">      link.<span class="property">href</span> = post.<span class="property">path</span>.<span class="title function_">startsWith</span>(<span class="string">&#x27;/&#x27;</span>) ? post.<span class="property">path</span> : <span class="string">&#x27;/&#x27;</span> + post.<span class="property">path</span>;</span><br><span class="line">      link.<span class="property">title</span> = post.<span class="property">title</span>;</span><br><span class="line">      </span><br><span class="line">      link.<span class="property">innerHTML</span> = <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;i class=&quot;fa fa-bookmark-o&quot;&gt;&lt;/i&gt;</span></span><br><span class="line"><span class="string">        &lt;span class=&quot;post-title-text&quot;&gt;<span class="subst">$&#123;post.title&#125;</span>&lt;/span&gt;</span></span><br><span class="line"><span class="string">        &lt;span class=&quot;post-date&quot;&gt;<span class="subst">$&#123;formatDate(post.date)&#125;</span>&lt;/span&gt;</span></span><br><span class="line"><span class="string">      `</span>;</span><br><span class="line">      </span><br><span class="line">      item.<span class="title function_">appendChild</span>(link);</span><br><span class="line">      list.<span class="title function_">appendChild</span>(item);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    container.<span class="title function_">appendChild</span>(list);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 调整标题字体大小以适应容器</span></span><br><span class="line">    <span class="title function_">adjustTitleFontSizes</span>(container);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 调整标题字体大小</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">adjustTitleFontSizes</span>(<span class="params">container</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> titleElements = container.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;.post-title-text&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> minFontSize = <span class="number">0.75</span>; <span class="comment">// rem，最小字体</span></span><br><span class="line">    <span class="keyword">const</span> defaultFontSize = <span class="number">1</span>; <span class="comment">// rem，默认字体</span></span><br><span class="line">    <span class="keyword">const</span> step = <span class="number">0.05</span>; <span class="comment">// 每次缩小的步长</span></span><br><span class="line"></span><br><span class="line">    titleElements.<span class="title function_">forEach</span>(<span class="function"><span class="params">titleEl</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 保持 overflow hidden 用于省略号</span></span><br><span class="line">      titleEl.<span class="property">style</span>.<span class="property">overflow</span> = <span class="string">&#x27;hidden&#x27;</span>;</span><br><span class="line">      titleEl.<span class="property">style</span>.<span class="property">textOverflow</span> = <span class="string">&#x27;ellipsis&#x27;</span>;</span><br><span class="line">      titleEl.<span class="property">style</span>.<span class="property">whiteSpace</span> = <span class="string">&#x27;nowrap&#x27;</span>;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 重置为默认字体</span></span><br><span class="line">      titleEl.<span class="property">style</span>.<span class="property">fontSize</span> = defaultFontSize + <span class="string">&#x27;rem&#x27;</span>;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">let</span> currentSize = defaultFontSize;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 使用 scrollWidth 和 clientWidth 比较检测溢出</span></span><br><span class="line">      <span class="comment">// 在 overflow: hidden 下，scrollWidth 仍然会返回内容的完整宽度</span></span><br><span class="line">      <span class="keyword">while</span> (titleEl.<span class="property">scrollWidth</span> &gt; titleEl.<span class="property">clientWidth</span> &amp;&amp; currentSize &gt; minFontSize) &#123;</span><br><span class="line">        currentSize -= step;</span><br><span class="line">        titleEl.<span class="property">style</span>.<span class="property">fontSize</span> = currentSize.<span class="title function_">toFixed</span>(<span class="number">2</span>) + <span class="string">&#x27;rem&#x27;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 插入到页面</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">insertContainer</span>(<span class="params">container</span>) &#123;</span><br><span class="line">    <span class="comment">// 优先尝试在 post-navigation 后面插入</span></span><br><span class="line">    <span class="keyword">let</span> target = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="variable constant_">CONFIG</span>.<span class="property">containerSelector</span>);</span><br><span class="line">    <span class="keyword">if</span> (target) &#123;</span><br><span class="line">      target.<span class="title function_">after</span>(container);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 备用：在 footer 后面插入</span></span><br><span class="line">    target = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="variable constant_">CONFIG</span>.<span class="property">fallbackSelector</span>);</span><br><span class="line">    <span class="keyword">if</span> (target) &#123;</span><br><span class="line">      target.<span class="title function_">after</span>(container);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 最后尝试：在 article 结尾插入</span></span><br><span class="line">    <span class="keyword">const</span> article = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;article&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (article) &#123;</span><br><span class="line">      article.<span class="title function_">appendChild</span>(container);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 加载当前文章的数据文件</span></span><br><span class="line">  <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">loadCurrentPostData</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> siteRoot = <span class="variable language_">window</span>.<span class="property">kr</span>?.<span class="property">siteRoot</span> || <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">      <span class="keyword">const</span> currentPath = <span class="title function_">getCurrentPath</span>();</span><br><span class="line">      <span class="keyword">const</span> dataFileName = <span class="title function_">pathToDataFileName</span>(currentPath);</span><br><span class="line">      <span class="keyword">const</span> dataUrl = siteRoot.<span class="title function_">replace</span>(<span class="regexp">/\/$/</span>, <span class="string">&#x27;&#x27;</span>) + <span class="variable constant_">CONFIG</span>.<span class="property">dataBasePath</span> + dataFileName;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(dataUrl);</span><br><span class="line">      <span class="keyword">if</span> (!response.<span class="property">ok</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>; <span class="comment">// 文件不存在是正常情况，静默返回</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">&#x27;[推荐阅读] 无法加载当前文章数据:&#x27;</span>, error);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 加载索引文件（用于回退和随机推荐）</span></span><br><span class="line">  <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">loadIndexData</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> siteRoot = <span class="variable language_">window</span>.<span class="property">kr</span>?.<span class="property">siteRoot</span> || <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">      <span class="keyword">const</span> indexUrl = siteRoot.<span class="title function_">replace</span>(<span class="regexp">/\/$/</span>, <span class="string">&#x27;&#x27;</span>) + <span class="variable constant_">CONFIG</span>.<span class="property">indexPath</span>;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(indexUrl);</span><br><span class="line">      <span class="keyword">if</span> (!response.<span class="property">ok</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`HTTP <span class="subst">$&#123;response.status&#125;</span>`</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">&#x27;[推荐阅读] 无法加载索引数据:&#x27;</span>, error);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 检查是否为文章页面（非首页、非列表页）</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">isPostPage</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> path = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">pathname</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 排除首页</span></span><br><span class="line">    <span class="keyword">if</span> (path === <span class="string">&#x27;/&#x27;</span> || path === <span class="string">&#x27;/index.html&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 排除分页页面 (如 /page/2/)</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/^\/page\/\d+\/?$/</span>.<span class="title function_">test</span>(path)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 排除分类页面</span></span><br><span class="line">    <span class="keyword">if</span> (path.<span class="title function_">startsWith</span>(<span class="string">&#x27;/categories&#x27;</span>) || path.<span class="title function_">startsWith</span>(<span class="string">&#x27;/category&#x27;</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 排除标签页面</span></span><br><span class="line">    <span class="keyword">if</span> (path.<span class="title function_">startsWith</span>(<span class="string">&#x27;/tags&#x27;</span>) || path.<span class="title function_">startsWith</span>(<span class="string">&#x27;/tag&#x27;</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 排除归档页面</span></span><br><span class="line">    <span class="keyword">if</span> (path.<span class="title function_">startsWith</span>(<span class="string">&#x27;/archives&#x27;</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 排除关于页面等独立页面（可根据需要调整）</span></span><br><span class="line">    <span class="keyword">if</span> (path === <span class="string">&#x27;/about/&#x27;</span> || path === <span class="string">&#x27;/about&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 检查是否存在文章特有元素</span></span><br><span class="line">    <span class="keyword">const</span> hasArticle = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;article[itemtype*=&quot;Article&quot;]&#x27;</span>) !== <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">const</span> hasPostClass = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.kratos-page-inner.kr-post&#x27;</span>) !== <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">const</span> hasPostContent = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.kratos-hentry&#x27;</span>) !== <span class="literal">null</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> hasArticle || hasPostClass || hasPostContent;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 主初始化函数</span></span><br><span class="line">  <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">init</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 仅在文章页面执行</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_">isPostPage</span>()) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 注入样式</span></span><br><span class="line">    <span class="title function_">injectStyles</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建容器并插入</span></span><br><span class="line">    <span class="keyword">const</span> container = <span class="title function_">createContainer</span>();</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_">insertContainer</span>(container)) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">&#x27;[推荐阅读] 无法找到合适的插入位置&#x27;</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 并行加载当前文章数据和索引</span></span><br><span class="line">    <span class="keyword">const</span> [postData, indexData] = <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>([</span><br><span class="line">      <span class="title function_">loadCurrentPostData</span>(),</span><br><span class="line">      <span class="title function_">loadIndexData</span>()</span><br><span class="line">    ]);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 渲染推荐文章</span></span><br><span class="line">    <span class="keyword">if</span> (postData || (indexData &amp;&amp; indexData.<span class="property">length</span> &gt; <span class="number">0</span>)) &#123;</span><br><span class="line">      <span class="title function_">renderPosts</span>(container, postData, indexData);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 监听窗口大小变化，重新调整字体</span></span><br><span class="line">      <span class="keyword">let</span> resizeTimeout;</span><br><span class="line">      <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">clearTimeout</span>(resizeTimeout);</span><br><span class="line">        resizeTimeout = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">adjustTitleFontSizes</span>(container);</span><br><span class="line">        &#125;, <span class="number">100</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> loading = container.<span class="title function_">querySelector</span>(<span class="string">&#x27;.recommended-posts-loading&#x27;</span>);</span><br><span class="line">      <span class="keyword">if</span> (loading) &#123;</span><br><span class="line">        loading.<span class="property">innerHTML</span> = <span class="string">&#x27;&lt;span class=&quot;recommended-posts-empty&quot;&gt;暂无推荐文章&lt;/span&gt;&#x27;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// PJAX 支持：页面更新后重新初始化</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">setupPjaxSupport</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;pjax:complete&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 移除旧的推荐阅读区块</span></span><br><span class="line">      <span class="keyword">const</span> existing = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.recommended-posts&#x27;</span>);</span><br><span class="line">      <span class="keyword">if</span> (existing) existing.<span class="title function_">remove</span>();</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 重新初始化</span></span><br><span class="line">      <span class="title function_">init</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 启动</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">readyState</span> === <span class="string">&#x27;loading&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;DOMContentLoaded&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">init</span>();</span><br><span class="line">      <span class="title function_">setupPjaxSupport</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">init</span>();</span><br><span class="line">    <span class="title function_">setupPjaxSupport</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>     </div></div>    </div><div class="collapse-box-control">    <div class="collapse-box-header"><div class="collapse-box-icon"><i class="fa fa-plus"></i></div><span>引入示例</span></div>    <div class="collapse-box-content"><div class="inner">        <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">additional_injections:</span></span><br><span class="line">  <span class="attr">after_footer:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    &lt;!-- 推荐阅读功能 --&gt;</span></span><br><span class="line"><span class="string">    &lt;script defer src=&quot;/js/recommended-posts.js&quot;&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>     </div></div>    </div><h3 id="2-配置环境变量"><a href="#2-配置环境变量" class="headerlink" title="2. 配置环境变量"></a>2. 配置环境变量</h3><p>创建 <code>.env</code> 文件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">OPENAI_API_KEY=sk-your-api-key</span><br><span class="line"></span><br><span class="line">OPENAI_BASE_URL=https://api.openai.com/v1</span><br><span class="line"></span><br><span class="line">OPENAI_EMBEDDING_MODEL=model-id</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p><strong>注意</strong>：将 <code>.env</code> 和 <code>embeddings_store/</code> 添加到 <code>.gitignore</code>，避免泄露密钥。</p></blockquote><h3 id="3-构建博客"><a href="#3-构建博客" class="headerlink" title="3. 构建博客"></a>3. 构建博客</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">hexo clean &amp;&amp; hexo generate</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>首次构建时会为所有文章生成 Embedding，可能需要一些时间。后续构建会使用缓存，只对修改过的文章重新计算。</p><p>对于使用Github Action进行自动部署的用户，需要在Action中完成对缓存文件的提交才能生效，否则每次构建都会重新计算所有文章的 Embedding。也可以选择在本地构建后，将生成的缓存文件提交到仓库中。</p><h3 id="4-GitHub-Actions-自动化配置（可选）"><a href="#4-GitHub-Actions-自动化配置（可选）" class="headerlink" title="4. GitHub Actions 自动化配置（可选）"></a>4. GitHub Actions 自动化配置（可选）</h3><p>如果你使用 GitHub Actions 进行自动部署，可以按以下步骤配置：</p><h4 id="配置-Repository-Secrets"><a href="#配置-Repository-Secrets" class="headerlink" title="配置 Repository Secrets"></a>配置 Repository Secrets</h4><p>在 GitHub 仓库的 <strong>Settings → Secrets and variables → Actions</strong> 中添加以下 Secrets：</p><ul><li><code>OPENAI_API_KEY</code>：OpenAI API 密钥</li><li><code>OPENAI_BASE_URL</code>：API 端点（可选，默认为 <code>https://api.openai.com/v1</code>）</li><li><code>OPENAI_EMBEDDING_MODEL</code>：Embedding 模型名称</li></ul><h4 id="更新-Workflow-文件"><a href="#更新-Workflow-文件" class="headerlink" title="更新 Workflow 文件"></a>更新 Workflow 文件</h4><p>在你的 GitHub Actions workflow 文件中，为构建步骤添加环境变量：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span> <span class="string">Hexo</span></span><br><span class="line">  <span class="attr">env:</span></span><br><span class="line">    <span class="attr">OPENAI_API_KEY:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.OPENAI_API_KEY</span> <span class="string">&#125;&#125;</span></span><br><span class="line">    <span class="attr">OPENAI_BASE_URL:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.OPENAI_BASE_URL</span> <span class="string">&#125;&#125;</span></span><br><span class="line">    <span class="attr">OPENAI_EMBEDDING_MODEL:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.OPENAI_EMBEDDING_MODEL</span> <span class="string">&#125;&#125;</span></span><br><span class="line">  <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    npx hexo clean</span></span><br><span class="line"><span class="string">    npx hexo generate</span></span><br></pre></td></tr></table></figure><h4 id="缓存持久化（推荐）"><a href="#缓存持久化（推荐）" class="headerlink" title="缓存持久化（推荐）"></a>缓存持久化（推荐）</h4><p>为了避免每次构建都重新计算所有 Embedding，建议在 workflow 中添加缓存提交步骤：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Commit</span> <span class="string">embedding</span> <span class="string">cache</span></span><br><span class="line">  <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    git config --local user.email &quot;github-actions[bot]@users.noreply.github.com&quot;</span></span><br><span class="line"><span class="string">    git config --local user.name &quot;github-actions[bot]&quot;</span></span><br><span class="line"><span class="string">    git add embeddings_store/cache.json || true</span></span><br><span class="line"><span class="string">    git diff --staged --quiet || git commit -m &quot;chore: update embedding cache [skip ci]&quot;</span></span><br><span class="line"><span class="string">    git push || true</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>提示</strong>：<code>[skip ci]</code> 标记可以避免缓存提交触发新的构建。</p></blockquote><h3 id="Embedding模型选择（仅供参考）"><a href="#Embedding模型选择（仅供参考）" class="headerlink" title="Embedding模型选择（仅供参考）"></a>Embedding模型选择（仅供参考）</h3><p>推荐OpenRouter的<a href="https://openrouter.ai/models/qwen/qwen3-embedding-8b">qwen&#x2F;qwen3-embedding-8b</a>模型，1M输入仅需$0.01，性价比极高。</p><h2 id="效果展示"><a href="#效果展示" class="headerlink" title="效果展示"></a>效果展示</h2><p>推荐阅读区块会自动插入到文章导航区域之后，展示风格如下：</p><ul><li><p>⭐ 标题图标，突出展示</p></li><li><p>📅 显示文章日期</p></li><li><p>🔖 优雅的列表样式</p></li><li><p>✨ 悬浮时的交互动画</p></li></ul><h2 id="技术亮点"><a href="#技术亮点" class="headerlink" title="技术亮点"></a>技术亮点</h2><ol><li><p><strong>语义理解</strong>：基于 Embedding 的相似度计算能够理解文章的语义内容，比基于标签&#x2F;分类的推荐更加精准</p></li><li><p><strong>增量计算</strong>：缓存机制确保只对修改过的文章重新计算，节省 API 调用成本</p></li><li><p><strong>优雅降级</strong>：即使没有配置 API，也能通过随机推荐提供基本功能</p></li><li><p><strong>零依赖前端</strong>：前端脚本不依赖任何框架，体积小巧</p></li><li><p><strong>主题适配</strong>：通过 CSS 变量自动适配主题样式，仅在<a href="https://github.com/Candinya/Kratos-Rebirth">Kratos-Rebirth</a>主题下进行测试。</p></li></ol><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>通过这两个脚本的配合，为 Hexo 博客实现了一个基于 AI 的智能推荐系统。它在构建时预计算所有推荐关系，运行时只需加载 JSON 数据，既保证了推荐质量，又不会影响页面加载性能。</p><p>希望这个方案能够帮助你提升博客的用户体验！如有问题欢迎在评论区讨论。</p>]]></content>
    
    
    <summary type="html">本文详细介绍了如何为Hexo博客集成基于OpenAI Embedding技术的智能推荐阅读功能。通过Node.js脚本在构建时计算文章语义相似度，并结合前端JavaScript实现优雅降级的展示策略。教程包含完整的自动化工作流、缓存机制设计及PJAX兼容方案，旨在通过AI技术提升博客用户体验与内容发现效率。</summary>
    
    
    
    <category term="技术分享" scheme="https://blog.rimuru.cc/categories/tech/"/>
    
    
    <category term="Hexo" scheme="https://blog.rimuru.cc/tags/hexo/"/>
    
    <category term="JavaScript" scheme="https://blog.rimuru.cc/tags/javascript/"/>
    
    <category term="OpenAI" scheme="https://blog.rimuru.cc/tags/openai/"/>
    
    <category term="博客优化" scheme="https://blog.rimuru.cc/tags/blog-optimization/"/>
    
  </entry>
  
  <entry>
    <title>Linux 系统管理：高频运维场景的一键命令合集</title>
    <link href="https://blog.rimuru.cc/2025/12/27/Linux-%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%EF%BC%9A%E9%AB%98%E9%A2%91%E8%BF%90%E7%BB%B4%E5%9C%BA%E6%99%AF%E7%9A%84%E4%B8%80%E9%94%AE%E5%91%BD%E4%BB%A4%E5%90%88%E9%9B%86/"/>
    <id>https://blog.rimuru.cc/2025/12/27/Linux-%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%EF%BC%9A%E9%AB%98%E9%A2%91%E8%BF%90%E7%BB%B4%E5%9C%BA%E6%99%AF%E7%9A%84%E4%B8%80%E9%94%AE%E5%91%BD%E4%BB%A4%E5%90%88%E9%9B%86/</id>
    <published>2025-12-27T16:45:03.000Z</published>
    <updated>2026-01-11T15:58:55.932Z</updated>
    
    <content type="html"><![CDATA[<h2 id="查看所有硬盘的SMART详细信息"><a href="#查看所有硬盘的SMART详细信息" class="headerlink" title="查看所有硬盘的SMART详细信息"></a>查看所有硬盘的SMART详细信息</h2><h3 id="依赖包安装"><a href="#依赖包安装" class="headerlink" title="依赖包安装"></a>依赖包安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install smartmontools</span><br></pre></td></tr></table></figure><h3 id="命令介绍"><a href="#命令介绍" class="headerlink" title="命令介绍"></a>命令介绍</h3><p>首先使用<code>lsblk</code>获取所有的存储设备，然后使用<code>grep</code>过滤出<code>sd</code>、<code>hd</code>、<code>nvme</code>、<code>vd</code>开头的设备，最后使用<code>xargs</code>和<code>smartctl</code>获取每个设备的SMART信息。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsblk -d -o NAME | grep -E <span class="string">&#x27;^(sd|hd|nvme|vd)&#x27;</span> | xargs -I &#123;&#125; <span class="built_in">sudo</span> smartctl -a <span class="string">&quot;/dev/&#123;&#125;&quot;</span></span><br></pre></td></tr></table></figure><h2 id="查看所有硬盘的SMART详细信息（极简输出）"><a href="#查看所有硬盘的SMART详细信息（极简输出）" class="headerlink" title="查看所有硬盘的SMART详细信息（极简输出）"></a>查看所有硬盘的SMART详细信息（极简输出）</h2><h3 id="依赖包安装-1"><a href="#依赖包安装-1" class="headerlink" title="依赖包安装"></a>依赖包安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install smartmontools</span><br></pre></td></tr></table></figure><h3 id="命令介绍-1"><a href="#命令介绍-1" class="headerlink" title="命令介绍"></a>命令介绍</h3><p>流程同上</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsblk -d -o NAME | grep -E <span class="string">&#x27;^(sd|hd|nvme|vd)&#x27;</span> | xargs -I &#123;&#125; <span class="built_in">sudo</span> smartctl -H <span class="string">&quot;/dev/&#123;&#125;&quot;</span></span><br></pre></td></tr></table></figure><h2 id="定位进程所属容器-Pod"><a href="#定位进程所属容器-Pod" class="headerlink" title="定位进程所属容器&#x2F;Pod"></a>定位进程所属容器&#x2F;Pod</h2><h3 id="依赖包安装-2"><a href="#依赖包安装-2" class="headerlink" title="依赖包安装"></a>依赖包安装</h3><p>定位pod需要crictl</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install crictl</span><br></pre></td></tr></table></figure><h3 id="命令介绍-2"><a href="#命令介绍-2" class="headerlink" title="命令介绍"></a>命令介绍</h3><h4 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h4><p>首先使用<code>cat</code>和<code>grep</code>获取进程所属的cgroup，然后使用<code>docker ps</code>和<code>grep</code>获取容器ID。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps | grep $(<span class="built_in">sudo</span> <span class="built_in">cat</span> /proc/&lt;pid&gt;/cgroup | grep -oP <span class="string">&#x27;docker-\K[a-f0-9]+&#x27;</span> | <span class="built_in">head</span> -c 12)</span><br></pre></td></tr></table></figure><h4 id="ctr-containerd"><a href="#ctr-containerd" class="headerlink" title="ctr(containerd)"></a>ctr(containerd)</h4><p>首先使用<code>cat</code>和<code>grep</code>获取进程所属的cgroup，然后选取包含pids的一行以去掉重复数据，直接从最后的信息中提取命名空间和容器名称。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">cat</span> /proc/&lt;pid&gt;/cgroup | grep pids | awk -F<span class="string">&#x27;/&#x27;</span> <span class="string">&#x27;&#123;print $(NF-1), $NF&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="Kubernetes获取容器id"><a href="#Kubernetes获取容器id" class="headerlink" title="Kubernetes获取容器id"></a>Kubernetes获取容器id</h4><p>首先使用<code>cat</code>和<code>grep</code>获取进程所属的cgroup, 然后选取包含pids的一行以去掉重复数据，从行中解析最后一级的前12位。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">cat</span> /proc/&lt;pid&gt;/cgroup | grep pids | awk -F<span class="string">&#x27;/&#x27;</span> <span class="string">&#x27;&#123;print substr($NF,1,12)&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="Kubernetes获取Pod名称"><a href="#Kubernetes获取Pod名称" class="headerlink" title="Kubernetes获取Pod名称"></a>Kubernetes获取Pod名称</h4><p>使用<code>crictl</code>根据容器ID获取Pod名称。其中容器ID为上一步获取到的12位ID。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crictl inspect -o go-template --template=<span class="string">&#x27;&#123;&#123;index .status.labels &quot;io.kubernetes.pod.name&quot;&#125;&#125;&#x27;</span> $(<span class="built_in">sudo</span> <span class="built_in">cat</span> /proc/&lt;pid&gt;/cgroup | grep pids | awk -F<span class="string">&#x27;/&#x27;</span> <span class="string">&#x27;&#123;print substr($NF,1,12)&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">本文汇总了Linux系统运维中的高频一键命令，涵盖使用smartmontools查看硬盘SMART健康状态，以及在Docker、Containerd和Kubernetes环境下通过进程PID快速定位所属容器或Pod的实用技巧。适合系统管理员与DevOps工程师提升日常排错效率。</summary>
    
    
    
    
    <category term="教程" scheme="https://blog.rimuru.cc/tags/tutorial/"/>
    
    <category term="问题解决" scheme="https://blog.rimuru.cc/tags/problem-solving/"/>
    
    <category term="Linux" scheme="https://blog.rimuru.cc/tags/linux/"/>
    
    <category term="Docker" scheme="https://blog.rimuru.cc/tags/docker/"/>
    
    <category term="磁盘管理" scheme="https://blog.rimuru.cc/tags/managing-disks/"/>
    
    <category term="运维命令" scheme="https://blog.rimuru.cc/tags/om-orders/"/>
    
    <category term="Kubernetes" scheme="https://blog.rimuru.cc/tags/kubernetes/"/>
    
    <category term="系统监控" scheme="https://blog.rimuru.cc/tags/system-monitoring/"/>
    
  </entry>
  
  <entry>
    <title>Overleaf(Sharelatex)本地部署无需邮箱重置管理员密码</title>
    <link href="https://blog.rimuru.cc/2025/12/26/Overleaf-Sharelatex-%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2%E6%97%A0%E9%9C%80%E9%82%AE%E7%AE%B1%E9%87%8D%E7%BD%AE%E7%AE%A1%E7%90%86%E5%91%98%E5%AF%86%E7%A0%81/"/>
    <id>https://blog.rimuru.cc/2025/12/26/Overleaf-Sharelatex-%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2%E6%97%A0%E9%9C%80%E9%82%AE%E7%AE%B1%E9%87%8D%E7%BD%AE%E7%AE%A1%E7%90%86%E5%91%98%E5%AF%86%E7%A0%81/</id>
    <published>2025-12-26T23:40:39.000Z</published>
    <updated>2025-12-27T15:01:15.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>通过从Overleaf的日志中获取重置密码的链接并重置密码，实现无需邮箱重置管理员密码。</p><h1 id="尝试发送重置密码邮件"><a href="#尝试发送重置密码邮件" class="headerlink" title="尝试发送重置密码邮件"></a>尝试发送重置密码邮件</h1><p>在登录界面点击<code>Forgot your password?</code>，然后输入邮箱地址，点击<code>Reset password</code>。</p><h1 id="获取重置密码链接"><a href="#获取重置密码链接" class="headerlink" title="获取重置密码链接"></a>获取重置密码链接</h1><p>运行下面的语句从Overleaf的log中获取重置密码的链接：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> &lt;container_name&gt; bash -c <span class="string">&quot;cd /var/log/overleaf/ &amp;&amp; cat web.log&quot;</span> | grep -oP <span class="string">&#x27;https?://[^\\]+&#x27;</span> | grep password</span><br></pre></td></tr></table></figure><p>得到的重置密码链接形如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/user/password/set?passwordResetToken=******&amp;email=******</span><br></pre></td></tr></table></figure><h1 id="替换域名（可选）"><a href="#替换域名（可选）" class="headerlink" title="替换域名（可选）"></a>替换域名（可选）</h1><p>在没有设置Overleaf的域名时，重置密码的链接会包含<code>localhost</code>，需要替换为实际的域名。</p><h1 id="重置密码"><a href="#重置密码" class="headerlink" title="重置密码"></a>重置密码</h1><p>打开获取到的重置密码链接，然后输入新密码，点击<code>Set new password</code>。</p>]]></content>
    
    
    <summary type="html">本文介绍如何在Overleaf（ShareLaTeX）本地部署环境下，通过Docker日志直接获取重置链接来修改管理员密码。该方法解决了因未配置邮件服务（SMTP）而无法通过邮箱找回密码的问题，涵盖了日志提取、链接解析及域名替换等实操步骤。</summary>
    
    
    
    
    <category term="教程" scheme="https://blog.rimuru.cc/tags/tutorial/"/>
    
    <category term="问题解决" scheme="https://blog.rimuru.cc/tags/problem-solving/"/>
    
    <category term="Linux" scheme="https://blog.rimuru.cc/tags/linux/"/>
    
    <category term="Docker" scheme="https://blog.rimuru.cc/tags/docker/"/>
    
    <category term="Overleaf" scheme="https://blog.rimuru.cc/tags/overleaf/"/>
    
    <category term="ShareLaTeX" scheme="https://blog.rimuru.cc/tags/sharelatex/"/>
    
  </entry>
  
  <entry>
    <title>HuggingfaceProxy：Hugging Face 反向代理加速方案</title>
    <link href="https://blog.rimuru.cc/2025/12/22/HuggingfaceProxy-%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/"/>
    <id>https://blog.rimuru.cc/2025/12/22/HuggingfaceProxy-%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/</id>
    <published>2025-12-22T21:00:00.000Z</published>
    <updated>2025-12-22T21:47:32.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="项目简介"><a href="#项目简介" class="headerlink" title="项目简介"></a>项目简介</h2><p>国内访问 Hugging Face 速度慢？下载模型超时？这个项目帮你解决。</p><p><strong>HuggingfaceProxy</strong> 是一个基于 Cloudflare Workers 的轻量级反向代理，帮你快速搭建 Hugging Face 访问加速服务。</p><p>项目地址：<a href="https://github.com/AinzRimuru/HuggingfaceProxy">https://github.com/AinzRimuru/HuggingfaceProxy</a></p><h2 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h2><ul><li><strong>零配置使用</strong> - 直接访问即可，所有请求自动转发到 Hugging Face</li><li><strong>智能重定向</strong> - 自动处理 CDN 重定向，无需多域名配置</li><li><strong>下载器脚本</strong> - 提供 Python 下载器，支持并行下载、断点续传</li><li><strong>模块化架构</strong> - 代码结构清晰，易于维护和扩展</li></ul><h2 id="快速开始"><a href="#快速开始" class="headerlink" title="快速开始"></a>快速开始</h2><h3 id="部署到-Cloudflare-Pages"><a href="#部署到-Cloudflare-Pages" class="headerlink" title="部署到 Cloudflare Pages"></a>部署到 Cloudflare Pages</h3><ol><li>Fork <a href="https://github.com/AinzRimuru/HuggingfaceProxy">本仓库</a></li><li>在 Cloudflare Dashboard 创建 Pages 项目，连接 GitHub 仓库</li><li>推送代码到 <code>main</code> 分支，GitHub Actions 会自动构建</li><li>Cloudflare Pages 自动拉取最新代码并部署</li></ol><p>部署完成后，Cloudflare 会自动分配一个 <code>*.pages.dev</code> 域名，也可以绑定自定义域名。</p><h3 id="本地开发"><a href="#本地开发" class="headerlink" title="本地开发"></a>本地开发</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装依赖</span></span><br><span class="line">npm install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建并启动开发服务器</span></span><br><span class="line">npm run dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># 部署</span></span><br><span class="line">npm run deploy</span><br></pre></td></tr></table></figure><h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><h3 id="直接访问"><a href="#直接访问" class="headerlink" title="直接访问"></a>直接访问</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 访问模型页面</span></span><br><span class="line">https://your-proxy.com/bert-base-uncased</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载模型文件</span></span><br><span class="line">https://your-proxy.com/bert-base-uncased/resolve/main/config.json</span><br><span class="line"></span><br><span class="line"><span class="comment"># API 调用</span></span><br><span class="line">https://your-proxy.com/api/models/bert-base-uncased</span><br></pre></td></tr></table></figure><h3 id="使用下载器脚本"><a href="#使用下载器脚本" class="headerlink" title="使用下载器脚本"></a>使用下载器脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载脚本</span></span><br><span class="line">curl -O https://your-proxy.com/hf_downloader.py</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装依赖</span></span><br><span class="line">pip install requests tqdm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载模型</span></span><br><span class="line">python hf_downloader.py bert-base-uncased</span><br><span class="line">python hf_downloader.py openai/whisper-large-v3 --<span class="built_in">type</span> model</span><br><span class="line">python hf_downloader.py bigcode/starcoder --revision main --workers 8</span><br></pre></td></tr></table></figure><blockquote><p>⚠️ <strong>注意</strong>: 不推荐使用 <code>huggingface-cli</code> 或 <code>snapshot_download</code> 搭配本代理。由于 Cloudflare 的缓存机制会覆盖或丢失 <code>Content-Length</code> 等关键头信息，会导致这些客户端下载失败。请使用本项目自带的下载脚本。</p></blockquote><h2 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h2><p>当 Hugging Face 返回重定向到 CDN 节点时，Worker 会自动改写 Location：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">原始: Location: https://cdn-lfs.hf.co/path/to/file</span><br><span class="line">改写: Location: https://your-proxy.com/redirect_to_cdn-lfs.hf.co/path/to/file</span><br></pre></td></tr></table></figure><p>这样所有请求都只需经过单一代理域名。</p><h2 id="配置说明"><a href="#配置说明" class="headerlink" title="配置说明"></a>配置说明</h2><p>编辑 <code>src/config.js</code> 可修改配置：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 允许的上游域名列表</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">ALLOWED_UPSTREAM_DOMAINS</span> = [<span class="string">&#x27;huggingface.co&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 默认上游域名</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">DEFAULT_UPSTREAM</span> = <span class="string">&#x27;huggingface.co&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重定向前缀</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">REDIRECT_PREFIX</span> = <span class="string">&#x27;redirect_to_&#x27;</span>;</span><br></pre></td></tr></table></figure><h2 id="License"><a href="#License" class="headerlink" title="License"></a>License</h2><p>MIT License</p><hr><p>项目地址：<a href="https://github.com/AinzRimuru/HuggingfaceProxy">https://github.com/AinzRimuru/HuggingfaceProxy</a></p>]]></content>
    
    
    <summary type="html">一个基于 Cloudflare Workers 的轻量级 Hugging Face 反向代理项目，帮助国内用户快速访问和下载 Hugging Face 模型。零配置使用，自动处理 CDN 重定向，并提供专用 Python 下载器支持并行下载和断点续传。</summary>
    
    
    
    <category term="技术分享" scheme="https://blog.rimuru.cc/categories/tech/"/>
    
    
    <category term="Cloudflare" scheme="https://blog.rimuru.cc/tags/cloudflare/"/>
    
    <category term="Hugging Face" scheme="https://blog.rimuru.cc/tags/hugging-face/"/>
    
    <category term="教程" scheme="https://blog.rimuru.cc/tags/tutorial/"/>
    
    <category term="反向代理" scheme="https://blog.rimuru.cc/tags/options/"/>
    
    <category term="模型下载" scheme="https://blog.rimuru.cc/tags/model-download/"/>
    
  </entry>
  
  <entry>
    <title>Nextcloud使用WebDAV访问分享文件夹</title>
    <link href="https://blog.rimuru.cc/2025/12/21/Nextcloud%E4%BD%BF%E7%94%A8WebDAV%E8%AE%BF%E9%97%AE%E5%88%86%E4%BA%AB%E6%96%87%E4%BB%B6%E5%A4%B9/"/>
    <id>https://blog.rimuru.cc/2025/12/21/Nextcloud%E4%BD%BF%E7%94%A8WebDAV%E8%AE%BF%E9%97%AE%E5%88%86%E4%BA%AB%E6%96%87%E4%BB%B6%E5%A4%B9/</id>
    <published>2025-12-21T21:22:27.000Z</published>
    <updated>2025-12-21T23:30:12.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-新建分享链接"><a href="#1-新建分享链接" class="headerlink" title="1. 新建分享链接"></a>1. 新建分享链接</h2><p>在 Nextcloud 网页端，选择需要分享的文件夹，创建共享链接可以以生成一个形如<code>https://*****/s/AaaAABbbBBCccCCC</code>的链接。其中<code>*****</code>为你的 Nextcloud 服务器地址，<code>AaaAABbbBBCccCCC</code>为分享链接的唯一标识符。</p><h2 id="2-配置访问密码（可选）"><a href="#2-配置访问密码（可选）" class="headerlink" title="2. 配置访问密码（可选）"></a>2. 配置访问密码（可选）</h2><p>在分享链接的设置中，可以选择在“自定义权限”中设置访问密码，以保护共享内容的安全。</p><h2 id="3-使用-WebDAV-访问分享文件夹"><a href="#3-使用-WebDAV-访问分享文件夹" class="headerlink" title="3. 使用 WebDAV 访问分享文件夹"></a>3. 使用 WebDAV 访问分享文件夹</h2><p>WebDAV 访问分享文件夹的URL为<code>https://*****/public.php/webdav</code>。用户名为1中生成的分享链接的唯一标识符<code>AaaAABbbBBCccCCC</code>，密码为2中设置的访问密码（如果有设置）。</p><h3 id="4-在文件管理器中访问"><a href="#4-在文件管理器中访问" class="headerlink" title="4 在文件管理器中访问"></a>4 在文件管理器中访问</h3><p>以 Windows11 为例，可以在此电脑右键选择“映射网络驱动器”，在文件夹栏中输入 WebDAV URL，并使用上述的用户名和密码进行连接。</p>]]></content>
    
    
    <summary type="html">本文详细介绍了如何在 Nextcloud 中通过 WebDAV 协议访问共享文件夹。通过创建分享链接并结合 public.php/webdav 接口，用户可以在 Windows 11 等文件管理器中将其映射为网络驱动器。教程涵盖了链接生成、密码保护设置及具体连接步骤，是解决 Nextcloud 外部协作与跨平台文件同步的高效方案。</summary>
    
    
    
    <category term="技术分享" scheme="https://blog.rimuru.cc/categories/tech/"/>
    
    
    <category term="教程" scheme="https://blog.rimuru.cc/tags/tutorial/"/>
    
    <category term="问题解决" scheme="https://blog.rimuru.cc/tags/problem-solving/"/>
    
    <category term="Nextcloud" scheme="https://blog.rimuru.cc/tags/nextcloud/"/>
    
    <category term="WebDAV" scheme="https://blog.rimuru.cc/tags/webdav/"/>
    
    <category term="网络驱动器" scheme="https://blog.rimuru.cc/tags/network-drives/"/>
    
    <category term="文件共享" scheme="https://blog.rimuru.cc/tags/shared-files/"/>
    
    <category term="Windows 11" scheme="https://blog.rimuru.cc/tags/windows-11/"/>
    
  </entry>
  
  <entry>
    <title>使用 Cloudflare Workers 搭建 Hugging Face 镜像代理</title>
    <link href="https://blog.rimuru.cc/2025/12/14/%E4%BD%BF%E7%94%A8-Cloudflare-Workers-%E6%90%AD%E5%BB%BA-Hugging-Face-%E9%95%9C%E5%83%8F%E4%BB%A3%E7%90%86/"/>
    <id>https://blog.rimuru.cc/2025/12/14/%E4%BD%BF%E7%94%A8-Cloudflare-Workers-%E6%90%AD%E5%BB%BA-Hugging-Face-%E9%95%9C%E5%83%8F%E4%BB%A3%E7%90%86/</id>
    <published>2025-12-14T21:04:21.000Z</published>
    <updated>2025-12-22T21:47:32.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="使用-Cloudflare-Workers-搭建-Hugging-Face-镜像代理"><a href="#使用-Cloudflare-Workers-搭建-Hugging-Face-镜像代理" class="headerlink" title="使用 Cloudflare Workers 搭建 Hugging Face 镜像代理"></a>使用 Cloudflare Workers 搭建 Hugging Face 镜像代理</h1><p>在进行 AI 模型开发时，Hugging Face 是绕不开的资源库。然而，直接访问 <code>huggingface.co</code> 及其 CDN 资源有时会遇到速度缓慢甚至连接失败的问题。</p><p>为了解决这个问题，我开发了一个基于 Cloudflare Workers 的轻量级反向代理项目 —— <strong>HuggingfaceProxy</strong>。</p><h2 id="🌟-项目介绍"><a href="#🌟-项目介绍" class="headerlink" title="🌟 项目介绍"></a>🌟 项目介绍</h2><p><strong>HuggingfaceProxy</strong> 是一个开源项目，利用 Cloudflare 全球边缘网络，为 Hugging Face 提供快速、稳定的访问代理。</p><p>项目地址：<a href="https://github.com/AinzRimuru/HuggingfaceProxy">https://github.com/AinzRimuru/HuggingfaceProxy</a></p><h3 id="核心特性"><a href="#核心特性" class="headerlink" title="核心特性"></a>核心特性</h3><ul><li><strong>零配置使用</strong>：直接访问即可，所有请求自动转发到 Hugging Face</li><li><strong>智能重定向</strong>：自动处理 CDN 重定向，无需多域名配置</li><li><strong>下载器脚本</strong>：提供 Python 下载器，支持并行下载、断点续传</li><li><strong>模块化架构</strong>：代码结构清晰，易于维护和扩展</li></ul><h2 id="🛠️-原理简析"><a href="#🛠️-原理简析" class="headerlink" title="🛠️ 原理简析"></a>🛠️ 原理简析</h2><p>核心逻辑在 <code>_worker.js</code> 中实现。当请求到达 Cloudflare Worker 时：</p><ol><li>解析请求路径，判断目标资源</li><li>将请求转发到 <code>huggingface.co</code></li><li>拦截重定向响应，自动改写 <code>Location</code> 头</li></ol><p>当 Hugging Face 返回重定向到 CDN 时，Worker 会自动改写：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">原始: Location: https://cdn-lfs.hf.co/path/to/file</span><br><span class="line">改写: Location: https://your-proxy.com/redirect_to_cdn-lfs.hf.co/path/to/file</span><br></pre></td></tr></table></figure><p>这样所有请求都只需经过单一代理域名，无需配置泛域名。</p><h2 id="🚀-如何部署"><a href="#🚀-如何部署" class="headerlink" title="🚀 如何部署"></a>🚀 如何部署</h2><p>推荐使用 <strong>Cloudflare Pages</strong> 进行部署，配置简单且免费额度充裕。</p><h3 id="方法一：Fork-Deploy（推荐）"><a href="#方法一：Fork-Deploy（推荐）" class="headerlink" title="方法一：Fork &amp; Deploy（推荐）"></a>方法一：Fork &amp; Deploy（推荐）</h3><ol><li><p><strong>Fork 项目</strong><br>访问 <a href="https://github.com/AinzRimuru/HuggingfaceProxy">GitHub 仓库</a>，点击 <code>Fork</code></p></li><li><p><strong>创建 Cloudflare Pages</strong><br>登录 Cloudflare Dashboard → <code>Workers &amp; Pages</code> → <code>Create</code> → <code>Pages</code> → <code>Connect to Git</code></p></li><li><p><strong>选择仓库</strong><br>选择你 Fork 的仓库，Framework preset 选择 <code>None</code>，直接部署</p></li><li><p><strong>绑定域名</strong>（可选）<br>部署完成后，可在 <code>Custom Domains</code> 设置中绑定自定义域名</p></li></ol><h3 id="方法二：使用-Wrangler-CLI"><a href="#方法二：使用-Wrangler-CLI" class="headerlink" title="方法二：使用 Wrangler CLI"></a>方法二：使用 Wrangler CLI</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 克隆项目</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/AinzRimuru/HuggingfaceProxy.git</span><br><span class="line"><span class="built_in">cd</span> HuggingfaceProxy</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装依赖</span></span><br><span class="line">npm install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 部署</span></span><br><span class="line">npm run deploy</span><br></pre></td></tr></table></figure><h2 id="📖-如何使用"><a href="#📖-如何使用" class="headerlink" title="📖 如何使用"></a>📖 如何使用</h2><p>假设你的代理域名是 <code>your-proxy.pages.dev</code>。</p><h3 id="直接访问"><a href="#直接访问" class="headerlink" title="直接访问"></a>直接访问</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 访问模型页面</span></span><br><span class="line">https://your-proxy.pages.dev/bert-base-uncased</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载模型文件</span></span><br><span class="line">https://your-proxy.pages.dev/bert-base-uncased/resolve/main/config.json</span><br><span class="line"></span><br><span class="line"><span class="comment"># API 调用</span></span><br><span class="line">https://your-proxy.pages.dev/api/models/bert-base-uncased</span><br></pre></td></tr></table></figure><h3 id="使用下载器脚本"><a href="#使用下载器脚本" class="headerlink" title="使用下载器脚本"></a>使用下载器脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载脚本</span></span><br><span class="line">curl -O https://your-proxy.pages.dev/hf_downloader.py</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装依赖</span></span><br><span class="line">pip install requests tqdm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载模型</span></span><br><span class="line">python hf_downloader.py bert-base-uncased</span><br><span class="line">python hf_downloader.py openai/whisper-large-v3 --<span class="built_in">type</span> model</span><br><span class="line">python hf_downloader.py bigcode/starcoder --workers 8</span><br></pre></td></tr></table></figure><blockquote><p>⚠️ <strong>注意</strong>: 不推荐使用 <code>huggingface-cli</code> 或 <code>snapshot_download</code> 搭配本代理。由于 Cloudflare 的缓存机制会丢失 <code>Content-Length</code> 等关键头信息，会导致这些客户端下载失败。请使用本项目自带的下载脚本。</p></blockquote><h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>通过这个 Cloudflare Worker 脚本，可以轻松搭建属于自己的 Hugging Face 加速通道。既解决了访问难题，又利用了 Serverless 架构的低成本优势。</p><p>如果你觉得这个项目有帮助，欢迎在 GitHub 上点个 Star！🌟</p>]]></content>
    
    
    <summary type="html">本文详细介绍如何使用 Cloudflare Workers/Pages 搭建 HuggingfaceProxy 镜像代理。通过该开源项目，利用 Cloudflare 全球边缘网络解决 Hugging Face 访问缓慢及模型下载失败的问题，包含完整的部署步骤和使用指南。</summary>
    
    
    
    <category term="技术分享" scheme="https://blog.rimuru.cc/categories/tech/"/>
    
    
    <category term="Cloudflare" scheme="https://blog.rimuru.cc/tags/cloudflare/"/>
    
    <category term="Hugging Face" scheme="https://blog.rimuru.cc/tags/hugging-face/"/>
    
    <category term="教程" scheme="https://blog.rimuru.cc/tags/tutorial/"/>
    
    <category term="反向代理" scheme="https://blog.rimuru.cc/tags/options/"/>
    
    <category term="AI工具" scheme="https://blog.rimuru.cc/tags/ai-tools/"/>
    
    <category term="Serverless" scheme="https://blog.rimuru.cc/tags/serverless/"/>
    
  </entry>
  
  <entry>
    <title>Wallpaper Engine 搜索作者教程</title>
    <link href="https://blog.rimuru.cc/2025/12/10/Wallpaper-Engine%E6%90%9C%E7%B4%A2%E4%BD%9C%E8%80%85/"/>
    <id>https://blog.rimuru.cc/2025/12/10/Wallpaper-Engine%E6%90%9C%E7%B4%A2%E4%BD%9C%E8%80%85/</id>
    <published>2025-12-10T22:24:09.000Z</published>
    <updated>2025-12-21T23:30:12.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Wallpaper Engine 本身并不支持根据名称直接搜索作者，但我们可以通过作者的 Steam 账号编号来访问其创意工坊主页。本文将介绍如何通过作者名称找到其创意工坊。</p><span id="more"></span><h2 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h2><h3 id="方法一：从已知壁纸查找（可选）"><a href="#方法一：从已知壁纸查找（可选）" class="headerlink" title="方法一：从已知壁纸查找（可选）"></a>方法一：从已知壁纸查找（可选）</h3><p>如果你已经有该作者的某个壁纸，可以通过以下步骤快速找到：</p><h4 id="1-打开壁纸详情页"><a href="#1-打开壁纸详情页" class="headerlink" title="1. 打开壁纸详情页"></a>1. 打开壁纸详情页</h4><p>在 Steam 创意工坊中打开任意一个该作者的壁纸。</p><p><img src="/2025/12/10/Wallpaper-Engine%E6%90%9C%E7%B4%A2%E4%BD%9C%E8%80%85/%E6%89%93%E5%BC%80%E5%A3%81%E7%BA%B8.png" alt="打开壁纸"></p><h4 id="2-进入作者的创意工坊"><a href="#2-进入作者的创意工坊" class="headerlink" title="2. 进入作者的创意工坊"></a>2. 进入作者的创意工坊</h4><p>点击作者名称进入其创意工坊主页。</p><p><img src="/2025/12/10/Wallpaper-Engine%E6%90%9C%E7%B4%A2%E4%BD%9C%E8%80%85/%E8%BF%9B%E5%85%A5%E4%BD%9C%E8%80%85%E7%9A%84%E5%88%9B%E6%84%8F%E5%B7%A5%E5%9D%8A.png" alt="进入作者的创意工坊"></p><h4 id="3-复制页面链接"><a href="#3-复制页面链接" class="headerlink" title="3. 复制页面链接"></a>3. 复制页面链接</h4><p>复制浏览器顶部的链接地址备用。链接格式如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://steamcommunity.com/profiles/********/myworkshopfiles/?appid=431960</span><br></pre></td></tr></table></figure><p><img src="/2025/12/10/Wallpaper-Engine%E6%90%9C%E7%B4%A2%E4%BD%9C%E8%80%85/%E5%A4%8D%E5%88%B6%E9%A1%B6%E9%83%A8%E9%93%BE%E6%8E%A5.png" alt="复制顶部链接"></p><blockquote><p><strong>提示</strong>：如果你已经知道作者的 Steam ID，可以直接跳到第 6 步。</p></blockquote><hr><h3 id="方法二：通过搜索作者名称"><a href="#方法二：通过搜索作者名称" class="headerlink" title="方法二：通过搜索作者名称"></a>方法二：通过搜索作者名称</h3><h4 id="4-搜索-Steam-用户"><a href="#4-搜索-Steam-用户" class="headerlink" title="4. 搜索 Steam 用户"></a>4. 搜索 Steam 用户</h4><p>访问 Steam 用户搜索页面，输入作者名称进行搜索：</p><p>🔗 <a href="https://steamcommunity.com/search/users/?l=schinese">Steam 用户搜索</a></p><p>找到目标用户后点击进入其个人主页。</p><h4 id="5-获取用户-Steam-ID"><a href="#5-获取用户-Steam-ID" class="headerlink" title="5. 获取用户 Steam ID"></a>5. 获取用户 Steam ID</h4><p>在用户主页中，点击”<strong>查看账号主人装备的物品</strong>“按钮（或访问积分商店相关页面）。</p><p><img src="/2025/12/10/Wallpaper-Engine%E6%90%9C%E7%B4%A2%E4%BD%9C%E8%80%85/%E6%9F%A5%E7%9C%8B%E8%B4%A6%E5%8F%B7%E8%A3%85%E5%A4%87.png" alt="查看账号装备"></p><h4 id="6-获取并构建创意工坊链接"><a href="#6-获取并构建创意工坊链接" class="headerlink" title="6. 获取并构建创意工坊链接"></a>6. 获取并构建创意工坊链接</h4><p>新打开的页面 URL 中包含了该用户的 Steam ID，格式如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://store.steampowered.com/points/profile/*********</span><br></pre></td></tr></table></figure><p>其中星号部分是一串数字（Steam ID）。</p><p>将这串数字替换到以下模板链接中：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://steamcommunity.com/profiles/[Steam_ID]/myworkshopfiles/?appid=431960</span><br></pre></td></tr></table></figure><p>将 <code>[Steam_ID]</code> 替换为实际的数字即可。</p><hr><h2 id="完成"><a href="#完成" class="headerlink" title="完成"></a>完成</h2><p>在浏览器中打开构建好的链接，即可访问该作者的 Wallpaper Engine 创意工坊主页，查看其所有作品。</p><hr><h2 id="小贴士"><a href="#小贴士" class="headerlink" title="小贴士"></a>小贴士</h2><ul><li>如果作者设置了隐私，可能无法查看其创意工坊内容</li><li>也可以通过浏览器插件来简化这个过程</li><li>收藏常用作者的创意工坊链接，方便下次访问</li></ul>]]></content>
    
    
    <summary type="html">Wallpaper Engine不支持直接根据名称搜索作者？本教程手把手教你如何通过作者的Steam ID或用户搜索功能，快速构建并访问特定作者的创意工坊主页。涵盖从已知壁纸查找、Steam用户搜索到链接构建的详细步骤，助你轻松获取心仪作者的所有动态壁纸资源。</summary>
    
    
    
    <category term="技术分享" scheme="https://blog.rimuru.cc/categories/tech/"/>
    
    
    <category term="教程" scheme="https://blog.rimuru.cc/tags/tutorial/"/>
    
    <category term="问题解决" scheme="https://blog.rimuru.cc/tags/problem-solving/"/>
    
    <category term="Wallpaper Engine" scheme="https://blog.rimuru.cc/tags/wallpaper-engine/"/>
    
    <category term="Steam" scheme="https://blog.rimuru.cc/tags/steam/"/>
    
    <category term="创意工坊" scheme="https://blog.rimuru.cc/tags/workshop/"/>
    
    <category term="Steam ID" scheme="https://blog.rimuru.cc/tags/steam-id/"/>
    
    <category term="壁纸搜索" scheme="https://blog.rimuru.cc/tags/wallpaper-search/"/>
    
  </entry>
  
  <entry>
    <title>天际线2 城市规划技巧指南</title>
    <link href="https://blog.rimuru.cc/2025/12/09/%E5%A4%A9%E9%99%85%E7%BA%BF2-%E5%9F%8E%E5%B8%82%E8%A7%84%E5%88%92%E6%8A%80%E5%B7%A7%E6%8C%87%E5%8D%97/"/>
    <id>https://blog.rimuru.cc/2025/12/09/%E5%A4%A9%E9%99%85%E7%BA%BF2-%E5%9F%8E%E5%B8%82%E8%A7%84%E5%88%92%E6%8A%80%E5%B7%A7%E6%8C%87%E5%8D%97/</id>
    <published>2025-12-09T09:55:31.000Z</published>
    <updated>2025-12-21T23:30:12.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="解决火车完全堵死至消失"><a href="#解决火车完全堵死至消失" class="headerlink" title="解决火车完全堵死至消失"></a>解决火车完全堵死至消失</h2><h3 id="1-在繁忙的火车站建立一个环形的等待区"><a href="#1-在繁忙的火车站建立一个环形的等待区" class="headerlink" title="1. 在繁忙的火车站建立一个环形的等待区"></a>1. 在繁忙的火车站建立一个环形的等待区</h3><p>在火车站附近建立一个环形的轨道，确保火车可以在此等待而不会堵塞主线。这可以有效地缓解火车站的拥堵问题，特别是繁忙的货运火车站。<br><img src="/2025/12/09/%E5%A4%A9%E9%99%85%E7%BA%BF2-%E5%9F%8E%E5%B8%82%E8%A7%84%E5%88%92%E6%8A%80%E5%B7%A7%E6%8C%87%E5%8D%97/%E7%81%AB%E8%BD%A6%E7%AB%99%E7%AD%89%E5%BE%85%E5%8C%BA%E5%9F%9F.png" alt="火车站等待区域"></p><h3 id="2-延长对外连接的支线建立等待区"><a href="#2-延长对外连接的支线建立等待区" class="headerlink" title="2. 延长对外连接的支线建立等待区"></a>2. 延长对外连接的支线建立等待区</h3><p>延长对外连接的支线，确保火车可以在支线上等待而不会堵塞主线。这可以帮助缓解由于对外连接拥堵导致的火车消失问题。<br><img src="/2025/12/09/%E5%A4%A9%E9%99%85%E7%BA%BF2-%E5%9F%8E%E5%B8%82%E8%A7%84%E5%88%92%E6%8A%80%E5%B7%A7%E6%8C%87%E5%8D%97/%E9%93%81%E8%B7%AF%E5%A4%96%E9%83%A8%E9%93%BE%E6%8E%A5%E7%AD%89%E5%BE%85%E5%8C%BA%E5%9F%9F.png" alt="铁路外部链接等待区域"></p><h2 id="解决（缓解）港口-货运站车辆堵塞的问题"><a href="#解决（缓解）港口-货运站车辆堵塞的问题" class="headerlink" title="解决（缓解）港口&#x2F;货运站车辆堵塞的问题"></a>解决（缓解）港口&#x2F;货运站车辆堵塞的问题</h2><h3 id="1-增加港口-货运站的数量"><a href="#1-增加港口-货运站的数量" class="headerlink" title="1. 增加港口&#x2F;货运站的数量"></a>1. 增加港口&#x2F;货运站的数量</h3><p>尽量保证所有的站点的到达的车辆数量相同。游戏中大部分的车辆都是按照就近原则进行分配的，因此避免将某一个站点放在区块的中心或者边缘的中心，尽量放置在四角的位置。</p><h3 id="2-避免跨越道路后再进入港口-货运站"><a href="#2-避免跨越道路后再进入港口-货运站" class="headerlink" title="2. 避免跨越道路后再进入港口&#x2F;货运站"></a>2. 避免跨越道路后再进入港口&#x2F;货运站</h3><p>跨越道路进入港口&#x2F;货运站会导致车辆在等待时占用道路资源，增加堵塞的可能性。尽量设计直接进入港口&#x2F;货运站的道路。如果车辆必须跨越道路，则延后跨越道路的位置，使得车辆能够快速的完成跨越道路的过程，减少对主路的堵塞。<br>具体而言，将可以跨越的道路修改为带分割线的道路，这样可以将车辆跨越道路的位置从站点附近延后到最近的十字路口，这里掉头造成阻塞的概率更小。<br><img src="/2025/12/09/%E5%A4%A9%E9%99%85%E7%BA%BF2-%E5%9F%8E%E5%B8%82%E8%A7%84%E5%88%92%E6%8A%80%E5%B7%A7%E6%8C%87%E5%8D%97/%E7%AB%99%E7%82%B9%E8%B7%A8%E8%B6%8A%E9%81%93%E8%B7%AF%E8%AE%BE%E8%AE%A1.png" alt="站点跨越道路设计"></p>]]></content>
    
    
    <summary type="html">本指南深入解析《天际线2》(Cities Skylines 2) 中的城市交通规划技巧，重点解决火车线路堵塞及货运港口车辆拥堵等核心痛点。通过建立环形等待区、优化对外连接支线以及改进货运站点道路设计，手把手教你提升城市物流效率，避免交通瘫痪，是硬核玩家必备的排堵优化攻略。</summary>
    
    
    
    <category term="游戏" scheme="https://blog.rimuru.cc/categories/gaming/"/>
    
    
    <category term="教程" scheme="https://blog.rimuru.cc/tags/tutorial/"/>
    
    <category term="Cities Skylines 2" scheme="https://blog.rimuru.cc/tags/cities-skylines-2/"/>
    
    <category term="天际线2" scheme="https://blog.rimuru.cc/tags/cities-skylines-2/"/>
    
    <category term="游戏攻略" scheme="https://blog.rimuru.cc/tags/game-guide/"/>
    
    <category term="交通规划" scheme="https://blog.rimuru.cc/tags/traffic-planning/"/>
    
    <category term="城市建设" scheme="https://blog.rimuru.cc/tags/city-build/"/>
    
    <category term="物流优化" scheme="https://blog.rimuru.cc/tags/logistics-optimization/"/>
    
  </entry>
  
  <entry>
    <title>天际线2 常见BUG解决方法汇总</title>
    <link href="https://blog.rimuru.cc/2025/12/09/%E5%A4%A9%E9%99%85%E7%BA%BF2-%E5%B8%B8%E8%A7%81BUG%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%B1%87%E6%80%BB/"/>
    <id>https://blog.rimuru.cc/2025/12/09/%E5%A4%A9%E9%99%85%E7%BA%BF2-%E5%B8%B8%E8%A7%81BUG%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%B1%87%E6%80%BB/</id>
    <published>2025-12-09T09:55:14.000Z</published>
    <updated>2025-12-21T23:30:12.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="邮局不出车"><a href="#邮局不出车" class="headerlink" title="邮局不出车"></a>邮局不出车</h2><h3 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h3><p>部分区块的邮局不出车，其他地方的邮局正常。邮局内有一些信件未被处理。</p><h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p>在邮局所属区块附近建立分拣中心，然后等待一段时间，邮局会开始出车处理信件。</p><h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><p>该方法在测试后仅在一段时间内有效，之后问题可能会再次出现。</p>]]></content>
    
    
    <summary type="html">本文汇总了《城市：天际线2》(Cities Skylines 2) 中的常见BUG及解决方法，重点针对邮局不出车、信件堆积等物流系统问题提供了实用的解决方案。通过建立分拣中心等策略，帮助玩家优化城市运行效率，解决游戏过程中的逻辑故障，是天际线2玩家必备的故障排除指南。</summary>
    
    
    
    <category term="游戏" scheme="https://blog.rimuru.cc/categories/gaming/"/>
    
    
    <category term="Cities Skylines 2" scheme="https://blog.rimuru.cc/tags/cities-skylines-2/"/>
    
    <category term="天际线2" scheme="https://blog.rimuru.cc/tags/cities-skylines-2/"/>
    
    <category term="游戏攻略" scheme="https://blog.rimuru.cc/tags/game-guide/"/>
    
    <category term="城市建设" scheme="https://blog.rimuru.cc/tags/city-build/"/>
    
    <category term="BUG修复" scheme="https://blog.rimuru.cc/tags/bug-fix/"/>
    
    <category term="游戏优化" scheme="https://blog.rimuru.cc/tags/game-optimization/"/>
    
  </entry>
  
  <entry>
    <title>虚拟机硬盘VMDK扩容和缩容(硬盘空间、分区、文件系统)</title>
    <link href="https://blog.rimuru.cc/2025/12/04/%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%A1%AC%E7%9B%98VMDK%E6%89%A9%E5%AE%B9%E5%92%8C%E7%BC%A9%E5%AE%B9-%E7%A1%AC%E7%9B%98%E7%A9%BA%E9%97%B4%E3%80%81%E5%88%86%E5%8C%BA%E3%80%81%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/"/>
    <id>https://blog.rimuru.cc/2025/12/04/%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%A1%AC%E7%9B%98VMDK%E6%89%A9%E5%AE%B9%E5%92%8C%E7%BC%A9%E5%AE%B9-%E7%A1%AC%E7%9B%98%E7%A9%BA%E9%97%B4%E3%80%81%E5%88%86%E5%8C%BA%E3%80%81%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/</id>
    <published>2025-12-04T16:17:34.000Z</published>
    <updated>2026-01-06T20:59:45.000Z</updated>
    
    <content type="html"><![CDATA[<p>本教程所使用的分区格式为GPT，文件系统为EXT4。LMV的分区扩容方式与GPT方式不同。</p><h2 id="1-扩容"><a href="#1-扩容" class="headerlink" title="1. 扩容"></a>1. 扩容</h2><p>扩容操作可以在线进行，但缩容操作不可以。</p><p>扩容分为三个部分。首先是对硬盘进行扩容，此时使用lsblk可以看到硬盘的实际容量变大，但是硬盘下的分区没有变大。之后是对分区进行扩容，此时lsblk可以看到硬盘内的分区也变大，但是df命令看到的可用空间没有变大。最后是对分区内的文件系统进行扩容，此时df命令可以看到分区的可用容量变大。</p><h3 id="1-1-硬盘空间扩容"><a href="#1-1-硬盘空间扩容" class="headerlink" title="1.1 硬盘空间扩容"></a>1.1 硬盘空间扩容</h3><p>vmdk文件可以直接在虚拟机内修改大小进行扩容。VMWare Workstation Pro以及ESXi都支持这样的操作，但都仅限于对硬盘进行扩容，直接缩小硬盘的大小是不被允许的。</p><p><img src="/2025/12/04/%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%A1%AC%E7%9B%98VMDK%E6%89%A9%E5%AE%B9%E5%92%8C%E7%BC%A9%E5%AE%B9-%E7%A1%AC%E7%9B%98%E7%A9%BA%E9%97%B4%E3%80%81%E5%88%86%E5%8C%BA%E3%80%81%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/ESXi%E4%BF%AE%E6%94%B9%E7%A1%AC%E7%9B%98%E5%A4%A7%E5%B0%8F.png" alt="ESXi修改硬盘大小"></p><p>![Workstation Pro修改硬盘大小](Workstation Pro修改硬盘大小.png)</p><p>此时使用lsblk可以看到硬盘被扩容。</p><h3 id="1-2-分区扩容"><a href="#1-2-分区扩容" class="headerlink" title="1.2 分区扩容"></a>1.2 分区扩容</h3><p>使用<code>parted /dev/&lt;device&gt;</code>命令进行修改，将<code>&lt;device&gt;</code>替换为对应的硬盘设备。</p><p>操作过程中可能会提示需要修复，按照提示进行修复即可。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 设置显示单位为扇区</span></span><br><span class="line"></span><br><span class="line">unit s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看分区详情包含为分配的扇区</span></span><br><span class="line"></span><br><span class="line">p free</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据结果选择最后一个分区标号调整分区大小</span></span><br><span class="line"></span><br><span class="line">resizepart &lt;分区号&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输入空闲扇区的最后一个扇区号以s结尾</span></span><br><span class="line"></span><br><span class="line">&lt;最后一个扇区编号&gt;s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 退出</span></span><br><span class="line"></span><br><span class="line">quit</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>此时再次使用lsblk命令可以看到分区已经被扩容。</p><h3 id="1-3-文件系统扩容"><a href="#1-3-文件系统扩容" class="headerlink" title="1.3 文件系统扩容"></a>1.3 文件系统扩容</h3><p>使用 <code>resize2fs /dev/&lt;device&gt;&lt;num&gt;</code> 对文件系统进行扩容，device为硬盘的编号，num为分区的编号，具体可以在lsblk中进行查看。 </p><p>此时，使用df命令可以看到可用空间已经顺利变大。</p><h2 id="2-缩容"><a href="#2-缩容" class="headerlink" title="2. 缩容"></a>2. 缩容</h2><p><strong>！！！缩容操作可能会导致数据丢失，必须严格按照步骤进行操作。</strong></p><p><strong>！！！最好先把对应的vmdk文件备份一份以免没有办法补救。</strong></p><h3 id="2-1-文件系统缩容"><a href="#2-1-文件系统缩容" class="headerlink" title="2.1 文件系统缩容"></a>2.1 文件系统缩容</h3><p>使用 <code>resize2fs /dev/&lt;device&gt;&lt;num&gt; &lt;size&gt;</code> 对分区进行缩容，<code>&lt;size&gt;</code>可以是xxK&#x2F;M&#x2F;G，如10G。</p><p>操作之后使用 <code>df -h</code> 命令查看缩小后的空间。</p><h3 id="2-2-分区缩容"><a href="#2-2-分区缩容" class="headerlink" title="2.2 分区缩容"></a>2.2 分区缩容</h3><p>同样使用parted进行缩容。</p><p><code>unit s</code> 指定的是扇区，也可以使用 <code>unit MB</code> <code>unit MiB</code> 指定单位为数据大小。具体可以参考 <em>parted单位支持详解及使用示例-CSDN博客</em>。</p><p><strong>！！！由于1000进制和1024进制的问题，GB级别上的容量差异约为95.4%，TB级别上的差异约为93.1%。因此安全起见建议先按照90%差异进行分区缩容，如文件系统缩容后为90GB,那么分区先按照100GB进行缩小。完成后使用lsblk查看分区，然后再决定是否继续缩小。</strong></p><h3 id="2-3-新建硬盘并分区"><a href="#2-3-新建硬盘并分区" class="headerlink" title="2.3 新建硬盘并分区"></a>2.3 新建硬盘并分区</h3><p>经过测试，此时直接对硬盘空间进行截断依然会导致分区损坏，因此只能按照预期缩小后的硬盘大小新建一块硬盘，然后按照原来的分区重新分区，使用dd命令进行完成分区内容的迁移。</p><p>为了保证复制过程的数据一致性，建议不要在硬盘挂载的情况下进行分区复制的操作，如果需要复制的是系统盘建议使用ubuntu的安装镜像以试用方式启动后进行操作。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#启动parted</span></span><br><span class="line"></span><br><span class="line">parted</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置单位为扇区</span></span><br><span class="line"></span><br><span class="line">unit s</span><br><span class="line"></span><br><span class="line"><span class="comment">#选择源硬盘</span></span><br><span class="line"></span><br><span class="line">selected /dev/&lt;原始硬盘的编号&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看分区，记得将输出的内容保存，新建分区需要参考</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#选择新建硬盘</span></span><br><span class="line"></span><br><span class="line">selected /dev/&lt;新硬盘编号&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#新建GPT分区表</span></span><br><span class="line"></span><br><span class="line">mklabel gpt</span><br><span class="line"></span><br><span class="line"><span class="comment">#按照需要依次建立分区,扇区起止直接照抄</span></span><br><span class="line"></span><br><span class="line">mkpart primary &lt;分区类型，File system一行有就填没有就省略&gt;  &lt;起始扇区&gt;s &lt;结束扇区&gt;s</span><br><span class="line"></span><br><span class="line"><span class="comment">#补全分区标记，print时看到部分分区的Flags一列有相关内容，多个标记以逗号进行分割</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> &lt;分区编号&gt; &lt;标记&gt; on</span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例，不要照抄，按照实际情况来</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># set 1 bios_grub on</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># set 2 boot on</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># set 2 esp on</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 最后退出</span></span><br><span class="line"></span><br><span class="line">quit</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>使用lsblk命令可以看到新硬盘的分区与源硬盘相同。</p><h3 id="2-4-分区数据复制"><a href="#2-4-分区数据复制" class="headerlink" title="2.4 分区数据复制"></a>2.4 分区数据复制</h3><p>分区复制的命令如下，逐个对分区进行复制。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/&lt;源硬盘编号&gt;&lt;分区编号&gt; of=/dev/&lt;新硬盘编号&gt;&lt;分区编号&gt; conv=noerror,<span class="built_in">sync</span> status=progress </span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-5-修改UUID"><a href="#2-5-修改UUID" class="headerlink" title="2.5 修改UUID"></a>2.5 修改UUID</h3><p>在2.4完成后，数据已经完成了迁移，但相应的uuid并没有被迁移。部分文件系统的挂载是根据UUID进行的，因此需要对UUID进行复制。</p><p>使用blkid可以获取磁盘的UUID、分区的UUID、文件系统的UUID，依次修改新硬盘使其与源硬盘相同。</p><p>使用 <code>gdisk /dev/&lt;新硬盘编号&gt;</code> 编辑分区和硬盘。 </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#进入高级模式</span></span><br><span class="line"></span><br><span class="line">x</span><br><span class="line"></span><br><span class="line"><span class="comment"># c       change partition GUID 修改分区的UUID</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># g       change disk GUID 修改硬盘的UUID</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改硬盘UUID</span></span><br><span class="line"></span><br><span class="line">c</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输入UUID</span></span><br><span class="line"></span><br><span class="line">&lt;uuid&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改分区UUID</span></span><br><span class="line"></span><br><span class="line">g</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输入编号</span></span><br><span class="line"></span><br><span class="line">&lt;编号&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输入uuid</span></span><br><span class="line"></span><br><span class="line">&lt;uuid&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 退出</span></span><br><span class="line"></span><br><span class="line">quit</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>使用 <code>tune2fs /dev/&lt;新硬盘编号&gt;&lt;分区编号&gt; -U &lt;uuid&gt;</code> 修改ext4文件系统的uuid，仅针对ext4文件系统，其他的文件系统的分区无需进行该操作。</p><p>至此，所有工作完成，移除源硬盘，只使用新硬盘，启动虚拟机。</p><h2 id="3-补充"><a href="#3-补充" class="headerlink" title="3. 补充"></a>3. 补充</h2><h3 id="3-1-空间不够新建硬盘"><a href="#3-1-空间不够新建硬盘" class="headerlink" title="3.1 空间不够新建硬盘"></a>3.1 空间不够新建硬盘</h3><p>将vmdk和vmdk-flat文件一同拷贝到其他设备，在新设备上操作。如果是缩容，新建硬盘的操作也要在原始机器上新建后再拷贝出来，否则可能会出现vmdk虚拟机版本不兼容的问题。操作时如果提示需要转换vmdk文件切记不要转换！</p>]]></content>
    
    
    <summary type="html">本教程详细介绍了虚拟机VMDK硬盘的扩容与缩容操作，涵盖GPT分区表与EXT4文件系统。内容包括使用VMware/ESXi调整硬件空间、利用parted进行分区扩容、resize2fs调整文件系统大小，以及通过dd命令和UUID修改实现安全的硬盘缩容与数据迁移，旨在解决Linux虚拟机磁盘空间不足或过大的问题。</summary>
    
    
    
    <category term="技术分享" scheme="https://blog.rimuru.cc/categories/tech/"/>
    
    
    <category term="教程" scheme="https://blog.rimuru.cc/tags/tutorial/"/>
    
    <category term="问题解决" scheme="https://blog.rimuru.cc/tags/problem-solving/"/>
    
    <category term="Linux" scheme="https://blog.rimuru.cc/tags/linux/"/>
    
    <category term="磁盘管理" scheme="https://blog.rimuru.cc/tags/managing-disks/"/>
    
    <category term="虚拟机" scheme="https://blog.rimuru.cc/tags/virtualization/"/>
    
    <category term="VMware" scheme="https://blog.rimuru.cc/tags/vmware/"/>
    
    <category term="EXT4" scheme="https://blog.rimuru.cc/tags/ext4/"/>
    
    <category term="分区扩容" scheme="https://blog.rimuru.cc/tags/partition-expansion/"/>
    
  </entry>
  
  <entry>
    <title>解决 Microsoft Word：错误!文档中没有指定样式的文字</title>
    <link href="https://blog.rimuru.cc/2025/12/04/%E8%A7%A3%E5%86%B3-Microsoft-Word%EF%BC%9A%E9%94%99%E8%AF%AF-%E6%96%87%E6%A1%A3%E4%B8%AD%E6%B2%A1%E6%9C%89%E6%8C%87%E5%AE%9A%E6%A0%B7%E5%BC%8F%E7%9A%84%E6%96%87%E5%AD%97/"/>
    <id>https://blog.rimuru.cc/2025/12/04/%E8%A7%A3%E5%86%B3-Microsoft-Word%EF%BC%9A%E9%94%99%E8%AF%AF-%E6%96%87%E6%A1%A3%E4%B8%AD%E6%B2%A1%E6%9C%89%E6%8C%87%E5%AE%9A%E6%A0%B7%E5%BC%8F%E7%9A%84%E6%96%87%E5%AD%97/</id>
    <published>2025-12-04T16:02:53.000Z</published>
    <updated>2025-12-21T23:30:12.000Z</updated>
    
    <content type="html"><![CDATA[<p>该报错一般出现在插入题注时，Word无法找到对应标题的样式而报错。一般有两种情况：</p><p><img src="/2025/12/04/%E8%A7%A3%E5%86%B3-Microsoft-Word%EF%BC%9A%E9%94%99%E8%AF%AF-%E6%96%87%E6%A1%A3%E4%B8%AD%E6%B2%A1%E6%9C%89%E6%8C%87%E5%AE%9A%E6%A0%B7%E5%BC%8F%E7%9A%84%E6%96%87%E5%AD%97/%E9%94%99%E8%AF%AF1.png" alt="错误1"></p><h2 id="1-没配置多级列表"><a href="#1-没配置多级列表" class="headerlink" title="1. 没配置多级列表"></a>1. 没配置多级列表</h2><p>这种情况比较简单，直接配置多级列表即可，本文不做赘述。</p><h2 id="2-多级列表制定的样式并非原本的标题样式，对标题使用了自己新建的样式"><a href="#2-多级列表制定的样式并非原本的标题样式，对标题使用了自己新建的样式" class="headerlink" title="2. 多级列表制定的样式并非原本的标题样式，对标题使用了自己新建的样式"></a>2. 多级列表制定的样式并非原本的标题样式，对标题使用了自己新建的样式</h2><p>本文主要解决第二种情况，即多级列表指定的样式并非原本的标题样式，对标题使用了自己新建的样式时，插入题注报错的问题。</p><h3 id="2-1-样式链接"><a href="#2-1-样式链接" class="headerlink" title="2.1 样式链接"></a>2.1 样式链接</h3><p>首先，将对应的原始标题的样式链接到你修改过的样式。原始标题的名称是”标题&lt;空格&gt;&lt;序号&gt;”，将对应等级的编号的样式链接到你当前使用的样式。此时，不会在出现没有制定样式的问题的报错，但是在插入题注后会出现标题中的第二种报错，如图所示。</p><p><img src="/2025/12/04/%E8%A7%A3%E5%86%B3-Microsoft-Word%EF%BC%9A%E9%94%99%E8%AF%AF-%E6%96%87%E6%A1%A3%E4%B8%AD%E6%B2%A1%E6%9C%89%E6%8C%87%E5%AE%9A%E6%A0%B7%E5%BC%8F%E7%9A%84%E6%96%87%E5%AD%97/%E9%94%99%E8%AF%AF2.png" alt="错误2"></p><h3 id="2-2-修改域属性"><a href="#2-2-修改域属性" class="headerlink" title="2.2 修改域属性"></a>2.2 修改域属性</h3><p>然后，右键报错的文字，选择编辑域。在弹出的窗口中保持StyleRef的域名不变，在域属性中找到当前标题使用的样式，在我这里是”标题1”，注意这个和原始的样式不是同一个，中间没有空格，是我自己新建的样式。</p><p><img src="/2025/12/04/%E8%A7%A3%E5%86%B3-Microsoft-Word%EF%BC%9A%E9%94%99%E8%AF%AF-%E6%96%87%E6%A1%A3%E4%B8%AD%E6%B2%A1%E6%9C%89%E6%8C%87%E5%AE%9A%E6%A0%B7%E5%BC%8F%E7%9A%84%E6%96%87%E5%AD%97/%E9%80%89%E6%8B%A9%E6%A0%B7%E5%BC%8F.png" alt="选择样式"></p><h3 id="2-3-更新域"><a href="#2-3-更新域" class="headerlink" title="2.3 更新域"></a>2.3 更新域</h3><p>最后，编号正常。</p><p><img src="/2025/12/04/%E8%A7%A3%E5%86%B3-Microsoft-Word%EF%BC%9A%E9%94%99%E8%AF%AF-%E6%96%87%E6%A1%A3%E4%B8%AD%E6%B2%A1%E6%9C%89%E6%8C%87%E5%AE%9A%E6%A0%B7%E5%BC%8F%E7%9A%84%E6%96%87%E5%AD%97/%E7%BC%96%E5%8F%B7%E6%AD%A3%E5%B8%B8.png" alt="编号正常"></p>]]></content>
    
    
    <summary type="html">本文针对 Microsoft Word 中常见的“错误！文档中没有指定样式的文字”提供详细解决方案。深入分析了多级列表配置缺失及自定义标题样式导致的题注报错问题，通过样式链接、编辑StyleRef域属性及更新域等步骤，手把手教你修复Word文档编号异常，提升办公效率。</summary>
    
    
    
    <category term="疑难杂症" scheme="https://blog.rimuru.cc/categories/troubleshooting/"/>
    
    
    <category term="教程" scheme="https://blog.rimuru.cc/tags/tutorial/"/>
    
    <category term="问题解决" scheme="https://blog.rimuru.cc/tags/problem-solving/"/>
    
    <category term="Microsoft Word" scheme="https://blog.rimuru.cc/tags/microsoft-word/"/>
    
    <category term="Office" scheme="https://blog.rimuru.cc/tags/office/"/>
    
    <category term="Word技巧" scheme="https://blog.rimuru.cc/tags/word-tips/"/>
    
    <category term="排版排错" scheme="https://blog.rimuru.cc/tags/typography-error/"/>
    
    <category term="题注报错" scheme="https://blog.rimuru.cc/tags/the-caption-is-incorrect/"/>
    
  </entry>
  
  <entry>
    <title>在Hexo博客中插入图片</title>
    <link href="https://blog.rimuru.cc/2025/12/04/%E5%9C%A8Hexo%E5%8D%9A%E5%AE%A2%E4%B8%AD%E6%8F%92%E5%85%A5%E5%9B%BE%E7%89%87/"/>
    <id>https://blog.rimuru.cc/2025/12/04/%E5%9C%A8Hexo%E5%8D%9A%E5%AE%A2%E4%B8%AD%E6%8F%92%E5%85%A5%E5%9B%BE%E7%89%87/</id>
    <published>2025-12-04T15:53:49.000Z</published>
    <updated>2025-12-21T23:30:12.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="在Hexo博客中插入图片"><a href="#在Hexo博客中插入图片" class="headerlink" title="在Hexo博客中插入图片"></a>在Hexo博客中插入图片</h2><p>在Hexo博客中插入图片非常简单,可以选择以下两种方式：</p><ol><li>直接在将所有的图片放在<code>source/images/</code>目录下，然后在Markdown文件中通过相对路径引用图片。</li></ol><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![<span class="string">图片描述</span>](<span class="link">/images/your-image.png</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="2"><li>使用Hexo的<code>post_asset_folder</code>功能，将图片与文章放在同一目录下。首先在Hexo配置文件<code>_config.yml</code>中启用<code>post_asset_folder</code>选项：</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">post_asset_folder:</span> <span class="literal">true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后在创建新文章时，Hexo会自动为该文章创建一个同名的文件夹，将图片放在该文件夹中。引用图片时，可以使用相对路径：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![<span class="string">图片描述</span>](<span class="link">your-image.png</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这样，图片就会正确显示在你的Hexo博客文章中。</p><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>部分项目会出现图片无法加载的情况，检查后会发现尝试从根目录加载图片，这时需要在Hexo配置文件中添加以下配置，确保图片路径正确解析。</p><p>在<code>_config.yml</code>中添加：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">marked:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">prependRoot:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">postAsset:</span> <span class="literal">true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这样可以确保Hexo在渲染Markdown时正确处理图片路径，避免加载失败的问题。</p>]]></content>
    
    
    <summary type="html">本文详细介绍了在Hexo博客中插入图片的两种核心方法：通过source/images目录统一管理及启用post_asset_folder实现资源文件夹管理。同时针对图片路径解析失败、无法加载等常见BUG，提供了修改_config.yml配置文件的解决方案，确保Markdown图片在Hexo中正确渲染。</summary>
    
    
    
    <category term="技术分享" scheme="https://blog.rimuru.cc/categories/tech/"/>
    
    
    <category term="Hexo" scheme="https://blog.rimuru.cc/tags/hexo/"/>
    
    <category term="问题解决" scheme="https://blog.rimuru.cc/tags/problem-solving/"/>
    
    <category term="博客教程" scheme="https://blog.rimuru.cc/tags/blog-tutorial/"/>
    
    <category term="Markdown" scheme="https://blog.rimuru.cc/tags/markdown/"/>
    
    <category term="图片配置" scheme="https://blog.rimuru.cc/tags/picture-configuration/"/>
    
    <category term="静态博客" scheme="https://blog.rimuru.cc/tags/static-blog/"/>
    
  </entry>
  
  <entry>
    <title>JetBrains学生许可证续订失败处理</title>
    <link href="https://blog.rimuru.cc/2025/12/04/JetBrains%E5%AD%A6%E7%94%9F%E8%AE%B8%E5%8F%AF%E8%AF%81%E7%BB%AD%E8%AE%A2%E5%A4%B1%E8%B4%A5%E5%A4%84%E7%90%86/"/>
    <id>https://blog.rimuru.cc/2025/12/04/JetBrains%E5%AD%A6%E7%94%9F%E8%AE%B8%E5%8F%AF%E8%AF%81%E7%BB%AD%E8%AE%A2%E5%A4%B1%E8%B4%A5%E5%A4%84%E7%90%86/</id>
    <published>2025-12-04T15:29:57.000Z</published>
    <updated>2025-12-21T23:30:12.000Z</updated>
    
    <content type="html"><![CDATA[<p>链接到新的教育邮箱账户即可。</p><h2 id="1-打开ManageAccount页面"><a href="#1-打开ManageAccount页面" class="headerlink" title="1. 打开ManageAccount页面"></a>1. 打开ManageAccount页面</h2><p><img src="/2025/12/04/JetBrains%E5%AD%A6%E7%94%9F%E8%AE%B8%E5%8F%AF%E8%AF%81%E7%BB%AD%E8%AE%A2%E5%A4%B1%E8%B4%A5%E5%A4%84%E7%90%86/step_1.png" alt="ManageAccount页面入口"></p><h2 id="2-新页面点Linked-emails"><a href="#2-新页面点Linked-emails" class="headerlink" title="2. 新页面点Linked emails"></a>2. 新页面点Linked emails</h2><p><img src="/2025/12/04/JetBrains%E5%AD%A6%E7%94%9F%E8%AE%B8%E5%8F%AF%E8%AF%81%E7%BB%AD%E8%AE%A2%E5%A4%B1%E8%B4%A5%E5%A4%84%E7%90%86/step_2.png" alt="Linked emails入口"></p><h2 id="3-输入教育邮箱，点击按钮"><a href="#3-输入教育邮箱，点击按钮" class="headerlink" title="3. 输入教育邮箱，点击按钮"></a>3. 输入教育邮箱，点击按钮</h2><p><img src="/2025/12/04/JetBrains%E5%AD%A6%E7%94%9F%E8%AE%B8%E5%8F%AF%E8%AF%81%E7%BB%AD%E8%AE%A2%E5%A4%B1%E8%B4%A5%E5%A4%84%E7%90%86/step_3.png" alt="添加教育邮箱"></p><h2 id="4-完成验证"><a href="#4-完成验证" class="headerlink" title="4. 完成验证"></a>4. 完成验证</h2><p>点一下邮件里面的链接，然后就能看到许可证了。</p>]]></content>
    
    
    <summary type="html">本文详细介绍了JetBrains学生许可证续订失败的解决办法。通过Manage Account页面关联（Linked emails）新的教育邮箱并完成验证，即可快速找回并激活你的JetBrains全家桶学生授权。适用于许可证过期或无法直接续订的场景。</summary>
    
    
    
    <category term="疑难杂症" scheme="https://blog.rimuru.cc/categories/troubleshooting/"/>
    
    
    <category term="教程" scheme="https://blog.rimuru.cc/tags/tutorial/"/>
    
    <category term="问题解决" scheme="https://blog.rimuru.cc/tags/problem-solving/"/>
    
    <category term="JetBrains" scheme="https://blog.rimuru.cc/tags/jetbrains/"/>
    
    <category term="学生许可" scheme="https://blog.rimuru.cc/tags/student-license/"/>
    
    <category term="教育优惠" scheme="https://blog.rimuru.cc/tags/educational-discount/"/>
    
    <category term="账号关联" scheme="https://blog.rimuru.cc/tags/account-linking/"/>
    
  </entry>
  
</feed>
